<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AcxiomProfileReport.scala</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">CIA</a> &gt; <a href="index.source.html" class="el_package">com.mbww.cia.dev.profile.reports</a> &gt; <span class="el_source">AcxiomProfileReport.scala</span></div><h1>AcxiomProfileReport.scala</h1><pre class="source lang-java linenums">package com.mbww.cia.dev.profile.reports

import com.mbww.cia.common.Spark._
import com.mbww.cia.common.{Module, _}
import org.apache.spark.sql.SaveMode
import org.apache.spark.storage.StorageLevel
import org.json.JSONObject

<span class="fc" id="L9">class AcxiomProfileReport extends Module {</span>



<span class="fc" id="L13">  private val MapRedFilOutComAlgVer = &quot;mapreduce.fileoutputcommitter.algorithm.version&quot;</span>

<span class="pc bpc" id="L15" title="36 of 37 branches missed.">  case class AcxiomKeyInfo(acxiomKeysPath: String,</span>
<span class="pc" id="L16">                           acxiomKeysMbidColumnName: String)</span>

<span class="pc bpc" id="L18" title="57 of 58 branches missed.">  case class AcxiomInfo(acxiomMarket: String,</span>
<span class="pc" id="L19">                        acxiomPath: String,</span>
<span class="pc" id="L20">                        acxiomMbidColumnName: String,</span>
<span class="pc" id="L21">                        acxiomLiverampMapPath: String,</span>
<span class="pc" id="L22">                        acxiomFilterExpr: String</span>
                        )

  def reportAcxiomUS(acxiomPath: String,
                     acxiomKeysPath: String,
                     outputPath: String): Unit = {

<span class="fc" id="L29">    var acxiomIbAutDfPath = acxiomPath + &quot;/ib_auto_2019_q4/&quot;</span>
<span class="fc" id="L30">    val acxiomIbAutDataframe = spark.read.parquet(acxiomIbAutDfPath).select(&quot;consumer_pel&quot;, &quot;auto_new_car_buyer&quot;, &quot;auto_current_acura&quot;, &quot;auto_current_audi&quot;, &quot;auto_current_bmw&quot;, &quot;auto_current_buick&quot;, &quot;auto_current_cadillac&quot;, &quot;auto_current_chevrolet&quot;, &quot;auto_current_chrysler&quot;, &quot;auto_current_dodge&quot;, &quot;auto_current_ford&quot;, &quot;auto_current_gmc&quot;, &quot;auto_current_honda_1&quot;, &quot;auto_current_hyundai&quot;, &quot;auto_current_infiniti&quot;, &quot;auto_current_isuzu&quot;, &quot;auto_current_jaguar&quot;, &quot;auto_current_jeep&quot;, &quot;auto_current_kia&quot;, &quot;auto_current_landrover&quot;, &quot;auto_current_lexus&quot;, &quot;auto_current_lincoln&quot;, &quot;auto_current_mazda&quot;, &quot;auto_current_mercedes&quot;, &quot;auto_current_mercury&quot;, &quot;auto_current_mini&quot;, &quot;auto_current_mitsubishi&quot;, &quot;auto_current_nissan&quot;, &quot;auto_current_oldsmobile&quot;, &quot;auto_current_plymouth&quot;, &quot;auto_current_pontiac&quot;, &quot;auto_current_porsche&quot;, &quot;auto_current_saab&quot;, &quot;auto_current_saturn&quot;, &quot;auto_current_scion&quot;, &quot;auto_current_subaru&quot;, &quot;auto_current_suzuki&quot;, &quot;auto_current_toyota&quot;, &quot;auto_current_volkswagen&quot;, &quot;auto_current_volvo&quot;, &quot;auto_current_yr_1998&quot;, &quot;auto_current_yr_1999&quot;, &quot;auto_current_yr_2000&quot;, &quot;auto_current_yr_2001&quot;, &quot;auto_current_yr_2002&quot;, &quot;auto_current_yr_2003&quot;, &quot;auto_current_yr_2004&quot;, &quot;auto_current_yr_2005&quot;, &quot;auto_current_yr_2006&quot;, &quot;auto_current_yr_2007&quot;, &quot;auto_current_yr_2008&quot;, &quot;auto_current_yr_2009&quot;, &quot;auto_current_yr_2010&quot;, &quot;auto_current_yr_2011&quot;, &quot;auto_current_yr_2012&quot;, &quot;auto_current_yr_2013&quot;, &quot;auto_current_yr_2014&quot;, &quot;auto_current_yr_2015&quot;, &quot;auto_current_yr_2016&quot;, &quot;auto_rental_last_1yr_business&quot;, &quot;auto_type_compact&quot;, &quot;auto_type_luxury&quot;, &quot;auto_type_mid_or_full_size&quot;, &quot;auto_type_motorcycle&quot;, &quot;auto_type_recreational&quot;, &quot;auto_type_suv&quot;, &quot;auto_type_sports&quot;, &quot;auto_type_truck&quot;, &quot;auto_type_van&quot;, &quot;auto_aff_new_vehicle_brand_suzuki&quot;, &quot;auto_club_member_aaa&quot;, &quot;auto_club_member_any&quot;, &quot;auto_club_member_aarp_roadside_assistance&quot;, &quot;auto_club_member_allstate_motor_club&quot;, &quot;auto_club_member_bp_motor_club&quot;, &quot;auto_club_member_warranty&quot;, &quot;auto_club_member_other_insurance&quot;, &quot;auto_rental_last_1yr_any&quot;, &quot;auto_rental_last_1yr_alamo&quot;, &quot;auto_rental_last_1yr_avis&quot;, &quot;auto_rental_last_1yr_budget&quot;, &quot;auto_rental_last_1yr_dollar&quot;, &quot;auto_rental_last_1yr_hertz&quot;, &quot;auto_rental_last_1yr_national&quot;, &quot;auto_rental_last_1yr_thrifty&quot;, &quot;auto_rental_last_1yr_other&quot;, &quot;auto_current_segment_suv&quot;, &quot;auto_current_segment_other_truck&quot;, &quot;auto_current_segment_other&quot;, &quot;auto_current_segment_van&quot;, &quot;auto_current_segment_minivan&quot;, &quot;auto_current_segment_heavy_duty_truck&quot;, &quot;auto_seg_upper_rung_city&quot;, &quot;auto_seg_upper_rung_suburban&quot;, &quot;auto_seg_rich_and_retired&quot;, &quot;auto_seg_married_with_children&quot;, &quot;auto_seg_the_single_life&quot;, &quot;auto_seg_urban_marrieds&quot;, &quot;auto_seg_working_for_a_living&quot;, &quot;auto_seg_wide_open_spaces&quot;, &quot;auto_seg_unattached_urbans&quot;, &quot;auto_seg_singles_on_a_shoestring&quot;, &quot;auto_in_market_new_luxury&quot;, &quot;auto_in_market_new_regular&quot;, &quot;auto_in_market_new&quot;, &quot;auto_new_vehicle_payment_cash&quot;, &quot;auto_new_vehicle_payment_finance&quot;, &quot;auto_new_vehicle_payment_lease&quot;, &quot;auto_country_origin_new_domestic_luxury&quot;, &quot;auto_country_origin_new_domestic_regular&quot;, &quot;auto_country_origin_new_european&quot;, &quot;auto_country_origin_new_japanese_luxury&quot;, &quot;auto_country_origin_new_japanese_regular&quot;, &quot;auto_country_origin_new_korean&quot;, &quot;auto_aff_new_vehicle_brand_acura&quot;, &quot;auto_aff_new_vehicle_brand_audi&quot;, &quot;auto_aff_new_vehicle_brand_bmw&quot;, &quot;auto_aff_new_vehicle_brand_buick&quot;, &quot;auto_aff_new_vehicle_brand_cadillac&quot;, &quot;auto_aff_new_vehicle_brand_chevrolet_2&quot;, &quot;auto_aff_new_vehicle_brand_chevrolet_truck&quot;, &quot;auto_aff_new_vehicle_brand_chevrolet_1&quot;, &quot;auto_aff_new_vehicle_brand_chrysler&quot;, &quot;auto_aff_new_vehicle_brand_dodge&quot;, &quot;auto_aff_new_vehicle_brand_ford_2&quot;, &quot;auto_aff_new_vehicle_brand_ford_truck&quot;, &quot;auto_aff_new_vehicle_brand_ford_1&quot;, &quot;auto_aff_new_vehicle_brand_gmc&quot;, &quot;auto_aff_new_vehicle_brand_honda&quot;, &quot;auto_aff_new_vehicle_brand_hyundai&quot;, &quot;auto_aff_new_vehicle_brand_infiniti&quot;, &quot;auto_aff_new_vehicle_brand_jaguar&quot;, &quot;auto_aff_new_vehicle_brand_jeep&quot;, &quot;auto_aff_new_vehicle_brand_kia&quot;, &quot;auto_aff_new_vehicle_brand_land_rover&quot;, &quot;auto_aff_new_vehicle_brand_lexus&quot;, &quot;auto_aff_new_vehicle_brand_lincoln&quot;, &quot;auto_aff_new_vehicle_brand_mazda&quot;, &quot;auto_aff_new_vehicle_brand_mercedes_benz&quot;, &quot;auto_aff_new_vehicle_brand_mini&quot;, &quot;auto_aff_new_vehicle_brand_mitsubishi&quot;, &quot;auto_aff_new_vehicle_brand_nissan&quot;, &quot;auto_aff_new_vehicle_brand_porsche&quot;, &quot;auto_aff_new_vehicle_brand_scion&quot;, &quot;auto_aff_new_vehicle_brand_subaru&quot;, &quot;auto_aff_new_vehicle_brand_toyota_2&quot;, &quot;auto_aff_new_vehicle_brand_toyota_truck&quot;, &quot;auto_aff_new_vehicle_brand_toyota_1&quot;, &quot;auto_aff_new_vehicle_brand_volkswagen&quot;, &quot;auto_aff_new_vehicle_brand_volvo&quot;, &quot;auto_purchase_compact_pickup&quot;, &quot;auto_purchase_compact_suv&quot;, &quot;auto_purchase_compact_van&quot;, &quot;auto_purchase_entry_compact&quot;, &quot;auto_purchase_entry_luxury&quot;, &quot;auto_purchase_entry_mid_size&quot;, &quot;auto_purchase_entry_sports&quot;, &quot;auto_purchase_full_size_suv&quot;, &quot;auto_purchase_full_size_heavy_duty_pickup&quot;, &quot;auto_purchase_full_size_light_duty_pickup&quot;, &quot;auto_purchase_luxury_sports&quot;, &quot;auto_purchase_luxury_suv&quot;, &quot;auto_purchase_mid_luxury&quot;, &quot;auto_purchase_mid_suv&quot;, &quot;auto_purchase_premium_compact&quot;, &quot;auto_purchase_premium_luxury&quot;, &quot;auto_purchase_premium_mid_size&quot;, &quot;auto_purchase_premium_sports&quot;, &quot;auto_aff_new_vehicle_brand_ram&quot;, &quot;auto_in_market_domestic_luxury&quot;, &quot;auto_in_market_new_domestic_regular&quot;, &quot;auto_in_market_new_european&quot;, &quot;auto_in_market_new_japanese_luxury&quot;, &quot;auto_in_market_new_japanese_regular&quot;, &quot;auto_in_market_new_korean&quot;, &quot;auto_purchase_new_compact_suv&quot;, &quot;auto_purchase_new_midsize_suv&quot;, &quot;auto_purchase_new_luxury_suv&quot;, &quot;auto_new_vehicle_type_electric&quot;, &quot;auto_new_vehicle_type_hybrid&quot;, &quot;auto_purchase_new_hybrid_luxury&quot;, &quot;auto_purchase_new_hybrid_regular&quot;, &quot;auto_purchase_new_hybrid_suv&quot;, &quot;auto_purchase_new_luxury_4wd&quot;, &quot;auto_purchase_new_regular_4wd&quot;, &quot;auto_purchase_new_luxury_awd&quot;, &quot;auto_purchase_new_regular_awd&quot;, &quot;auto_purchase_new_luxury_convertible&quot;, &quot;auto_purchase_new_regular_convertible&quot;, &quot;auto_purchase_new_luxury_coupe&quot;, &quot;auto_purchase_new_regular_coupe&quot;, &quot;auto_purchase_new_luxury_diesel&quot;, &quot;auto_purchase_new_regular_diesel&quot;, &quot;auto_purchase_new_luxury_sedan&quot;, &quot;auto_purchase_new_regular_sedan&quot;, &quot;auto_purchase_new_luxury_wagon&quot;, &quot;auto_purchase_new_regular_wagon&quot;, &quot;auto_current_segment_motorcycle&quot;, &quot;auto_current_segment_rv&quot;, &quot;auto_current_segment_pickup&quot;, &quot;auto_current_honda_2&quot;, &quot;auto_loyalty_brand_loyal&quot;, &quot;auto_loyalty_brand_switcher&quot;, &quot;auto_loyalty_segment_loyal&quot;, &quot;auto_loyalty_segment_switcher&quot;, &quot;auto_loyalty_regular_to_luxury&quot;, &quot;auto_loyalty_car_to_pickup&quot;, &quot;auto_loyalty_car_to_suv&quot;, &quot;auto_loyalty_car_to_van&quot;, &quot;auto_in_market_used&quot;, &quot;auto_country_origin_used_domestic_luxury&quot;, &quot;auto_country_origin_used_domestic_regular&quot;, &quot;auto_country_origin_used_european&quot;, &quot;auto_country_origin_used_japanese_luxury&quot;, &quot;auto_country_origin_used_japanese_regular&quot;, &quot;auto_country_origin_used_korean&quot;, &quot;auto_used_brand_chevrolet&quot;, &quot;auto_used_brand_ford&quot;, &quot;auto_used_brand_honda&quot;, &quot;auto_used_brand_hyundai&quot;, &quot;auto_used_brand_nissan&quot;, &quot;auto_used_brand_toyota&quot;, &quot;auto_vehicle_feature_internet&quot;, &quot;auto_current_yr_2017&quot;, &quot;auto_current_yr_2018&quot;, &quot;auto_current_yr_2019_newer&quot;)</span>
<span class="fc" id="L31">    val acxiomIbAutNewColumnNames = Seq(&quot;consumer_pel&quot;, &quot;1948&quot;, &quot;2002&quot;, &quot;2005&quot;, &quot;2006&quot;, &quot;2007&quot;, &quot;2008&quot;, &quot;2009&quot;, &quot;2010&quot;, &quot;2013&quot;, &quot;2015&quot;, &quot;2017&quot;, &quot;2018&quot;, &quot;2020&quot;, &quot;2021&quot;, &quot;2022&quot;, &quot;2023&quot;, &quot;2024&quot;, &quot;2025&quot;, &quot;2026&quot;, &quot;2027&quot;, &quot;2028&quot;, &quot;2029&quot;, &quot;2030&quot;, &quot;2031&quot;, &quot;2033&quot;, &quot;2034&quot;, &quot;2035&quot;, &quot;2036&quot;, &quot;2038&quot;, &quot;2039&quot;, &quot;2040&quot;, &quot;2041&quot;, &quot;2042&quot;, &quot;2043&quot;, &quot;2046&quot;, &quot;2047&quot;, &quot;2048&quot;, &quot;2049&quot;, &quot;2050&quot;, &quot;2064&quot;, &quot;2065&quot;, &quot;2066&quot;, &quot;2067&quot;, &quot;2068&quot;, &quot;2069&quot;, &quot;2070&quot;, &quot;2071&quot;, &quot;2072&quot;, &quot;2073&quot;, &quot;2074&quot;, &quot;2075&quot;, &quot;2076&quot;, &quot;2077&quot;, &quot;2078&quot;, &quot;2079&quot;, &quot;2080&quot;, &quot;2081&quot;, &quot;2082&quot;, &quot;10739&quot;, &quot;10748&quot;, &quot;10749&quot;, &quot;10750&quot;, &quot;10751&quot;, &quot;10752&quot;, &quot;10753&quot;, &quot;10754&quot;, &quot;10755&quot;, &quot;10756&quot;, &quot;300002799&quot;, &quot;300008599&quot;, &quot;300025099&quot;, &quot;300025199&quot;, &quot;300025299&quot;, &quot;300025399&quot;, &quot;300025499&quot;, &quot;300025599&quot;, &quot;300026799&quot;, &quot;300026899&quot;, &quot;300026999&quot;, &quot;300027099&quot;, &quot;300027199&quot;, &quot;300027299&quot;, &quot;300027399&quot;, &quot;300027499&quot;, &quot;300027599&quot;, &quot;300027799&quot;, &quot;300027899&quot;, &quot;300027999&quot;, &quot;300028199&quot;, &quot;300028299&quot;, &quot;300028599&quot;, &quot;300129001&quot;, &quot;300129002&quot;, &quot;300129003&quot;, &quot;300129004&quot;, &quot;300129005&quot;, &quot;300129006&quot;, &quot;300129007&quot;, &quot;300129008&quot;, &quot;300129009&quot;, &quot;300129010&quot;, &quot;300441499&quot;, &quot;300441599&quot;, &quot;300448599&quot;, &quot;300448699&quot;, &quot;300448799&quot;, &quot;300448899&quot;, &quot;300448999&quot;, &quot;300449099&quot;, &quot;300449199&quot;, &quot;300449299&quot;, &quot;300449399&quot;, &quot;300449499&quot;, &quot;300449599&quot;, &quot;300449699&quot;, &quot;300449799&quot;, &quot;300449899&quot;, &quot;300449999&quot;, &quot;300450099&quot;, &quot;300450199&quot;, &quot;300450299&quot;, &quot;300450399&quot;, &quot;300450499&quot;, &quot;300450599&quot;, &quot;300450699&quot;, &quot;300450799&quot;, &quot;300450899&quot;, &quot;300450999&quot;, &quot;300451099&quot;, &quot;300451199&quot;, &quot;300451299&quot;, &quot;300451399&quot;, &quot;300451499&quot;, &quot;300451599&quot;, &quot;300451699&quot;, &quot;300451799&quot;, &quot;300451899&quot;, &quot;300451999&quot;, &quot;300452099&quot;, &quot;300452199&quot;, &quot;300452299&quot;, &quot;300452399&quot;, &quot;300452499&quot;, &quot;300452599&quot;, &quot;300452699&quot;, &quot;300452799&quot;, &quot;300452899&quot;, &quot;300452999&quot;, &quot;300453099&quot;, &quot;300453199&quot;, &quot;300453299&quot;, &quot;300453399&quot;, &quot;300453499&quot;, &quot;300453599&quot;, &quot;300453699&quot;, &quot;300453799&quot;, &quot;300453899&quot;, &quot;300453999&quot;, &quot;300454099&quot;, &quot;300454199&quot;, &quot;300454299&quot;, &quot;300454399&quot;, &quot;300454499&quot;, &quot;300454599&quot;, &quot;300454699&quot;, &quot;300454799&quot;, &quot;300454899&quot;, &quot;300454999&quot;, &quot;300455399&quot;, &quot;300455499&quot;, &quot;300455599&quot;, &quot;300455699&quot;, &quot;300455799&quot;, &quot;300455899&quot;, &quot;300455999&quot;, &quot;300456099&quot;, &quot;300456199&quot;, &quot;300456299&quot;, &quot;300456399&quot;, &quot;300456499&quot;, &quot;300456599&quot;, &quot;300456699&quot;, &quot;300456799&quot;, &quot;300456899&quot;, &quot;300456999&quot;, &quot;300457099&quot;, &quot;300457199&quot;, &quot;300457299&quot;, &quot;300457399&quot;, &quot;300457499&quot;, &quot;300457599&quot;, &quot;300457699&quot;, &quot;300457799&quot;, &quot;300457899&quot;, &quot;300457999&quot;, &quot;300458099&quot;, &quot;300528799&quot;, &quot;300528899&quot;, &quot;300528999&quot;, &quot;300529299&quot;, &quot;300610399&quot;, &quot;300610499&quot;, &quot;300610599&quot;, &quot;300610699&quot;, &quot;300611099&quot;, &quot;300611199&quot;, &quot;300611299&quot;, &quot;300611399&quot;, &quot;300614099&quot;, &quot;300614199&quot;, &quot;300614299&quot;, &quot;300614399&quot;, &quot;300614499&quot;, &quot;300614599&quot;, &quot;300614699&quot;, &quot;300614799&quot;, &quot;300614899&quot;, &quot;300614999&quot;, &quot;300615099&quot;, &quot;300615199&quot;, &quot;300615299&quot;, &quot;300624099&quot;, &quot;800904217&quot;, &quot;800904218&quot;, &quot;800904299&quot;)</span>
<span class="fc" id="L32">    val acxiomIbAutDefDf = acxiomIbAutDataframe.toDF(acxiomIbAutNewColumnNames: _*)</span>
<span class="fc" id="L33">    acxiomIbAutDefDf.createOrReplaceTempView(&quot;acxiomIb_aut_def_df_view&quot;)</span>

<span class="fc" id="L35">    var acxiomIbDemDfPath = acxiomPath + &quot;/ib_demo_2019_q4/&quot;</span>
<span class="fc" id="L36">    val acxiomIbDemDataframe = spark.read.parquet(acxiomIbDemDfPath).select(&quot;consumer_pel&quot;, &quot;demo_life_event_new_parent_lte_6m&quot;, &quot;demo_life_event_new_parent_7_9m&quot;, &quot;demo_life_event_new_parent_10_1yr&quot;, &quot;demo_number_of_children_1&quot;, &quot;demo_number_of_children_2&quot;, &quot;demo_number_of_children_3&quot;, &quot;demo_number_of_children_4&quot;, &quot;demo_number_of_children_5plus&quot;, &quot;demo_home_owner&quot;, &quot;demo_home_renter&quot;, &quot;demo_presence_of_children_n&quot;, &quot;demo_presence_of_children_y&quot;, &quot;demo_age_range_18_19&quot;, &quot;demo_age_range_20_21&quot;, &quot;demo_age_range_22_23&quot;, &quot;demo_age_range_24_25&quot;, &quot;demo_age_range_26_27&quot;, &quot;demo_age_range_28_29&quot;, &quot;demo_age_range_30_31&quot;, &quot;demo_age_range_32_33&quot;, &quot;demo_age_range_34_35&quot;, &quot;demo_age_range_36_37&quot;, &quot;demo_age_range_38_39&quot;, &quot;demo_age_range_40_41&quot;, &quot;demo_age_range_42_43&quot;, &quot;demo_age_range_44_45&quot;, &quot;demo_age_range_46_47&quot;, &quot;demo_age_range_48_49&quot;, &quot;demo_age_range_50_51&quot;, &quot;demo_age_range_52_53&quot;, &quot;demo_age_range_54_55&quot;, &quot;demo_age_range_56_57&quot;, &quot;demo_age_range_58_59&quot;, &quot;demo_age_range_60_61&quot;, &quot;demo_age_range_62_63&quot;, &quot;demo_age_range_64_65&quot;, &quot;demo_age_range_66_67&quot;, &quot;demo_age_range_68_69&quot;, &quot;demo_age_range_70_71&quot;, &quot;demo_age_range_72_73&quot;, &quot;demo_age_range_74_75&quot;, &quot;demo_age_range_76_77&quot;, &quot;demo_age_range_78_79&quot;, &quot;demo_age_range_80_81&quot;, &quot;demo_age_range_82_83&quot;, &quot;demo_age_range_84_85&quot;, &quot;demo_age_range_86_87&quot;, &quot;demo_age_range_88_89&quot;, &quot;demo_age_range_90_91&quot;, &quot;demo_age_range_92_93&quot;, &quot;demo_age_range_94_95&quot;, &quot;demo_age_range_96_97&quot;, &quot;demo_age_range_98_99&quot;, &quot;demo_income_lt_15K_1&quot;, &quot;demo_income_15K_20K_1&quot;, &quot;demo_income_20K_30K_1&quot;, &quot;demo_income_30K_40K_1&quot;, &quot;demo_income_40K_50K_1&quot;, &quot;demo_income_50K_75K&quot;, &quot;demo_income_75K_100K&quot;, &quot;demo_gender_female&quot;, &quot;demo_gender_male&quot;, &quot;demo_marital_status_married_2&quot;, &quot;demo_marital_status_single_2&quot;, &quot;demo_edu_highschool&quot;, &quot;demo_edu_college&quot;, &quot;demo_edu_graduate&quot;, &quot;demo_edu_vocational_or_technical&quot;, &quot;demo_income_100K_150K&quot;, &quot;demo_income_150K_175K&quot;, &quot;demo_income_175K_200K&quot;, &quot;demo_income_200K_250K&quot;, &quot;demo_income_250Kplus&quot;, &quot;demo_occupation_detail_attorney&quot;, &quot;demo_occupation_detail_doctor&quot;, &quot;demo_occupation_detail_pilot&quot;, &quot;demo_occupation_detail_account_exec&quot;, &quot;demo_occupation_detail_manager&quot;, &quot;demo_occupation_detail_agent&quot;, &quot;demo_occupation_detail_broker_or_stocktrader&quot;, &quot;demo_occupation_detail_insurance_or_agent&quot;, &quot;demo_occupation_detail_realtor&quot;, &quot;demo_occupation_detail_sales&quot;, &quot;demo_occupation_detail_cosmetologist&quot;, &quot;demo_occupation_detail_laborer&quot;, &quot;demo_occupation_detail_orderly&quot;, &quot;demo_occupation_detail_legal_secretary&quot;, &quot;demo_occupation_detail_homemaker&quot;, &quot;demo_occupation_detail_nurse&quot;, &quot;demo_behavior_college_child_go&quot;, &quot;demo_behavior_college_child_grad&quot;, &quot;demo_behavior_college_start&quot;, &quot;demo_behavior_college_attend_fall&quot;, &quot;demo_behavior_college_start_child_start_w_in_6_mths&quot;)</span>
<span class="fc" id="L37">    val acxiomIbDemNewColumnNames = Seq(&quot;consumer_pel&quot;, &quot;1241&quot;, &quot;1242&quot;, &quot;1243&quot;, &quot;1637&quot;, &quot;1638&quot;, &quot;1639&quot;, &quot;1640&quot;, &quot;1645&quot;, &quot;1700&quot;, &quot;1701&quot;, &quot;1820&quot;, &quot;1821&quot;, &quot;1836&quot;, &quot;1837&quot;, &quot;1838&quot;, &quot;1839&quot;, &quot;1840&quot;, &quot;1841&quot;, &quot;1842&quot;, &quot;1843&quot;, &quot;1844&quot;, &quot;1845&quot;, &quot;1846&quot;, &quot;1847&quot;, &quot;1848&quot;, &quot;1849&quot;, &quot;1850&quot;, &quot;1851&quot;, &quot;1852&quot;, &quot;1853&quot;, &quot;1854&quot;, &quot;1855&quot;, &quot;1856&quot;, &quot;1857&quot;, &quot;1858&quot;, &quot;1859&quot;, &quot;1860&quot;, &quot;1861&quot;, &quot;1862&quot;, &quot;1863&quot;, &quot;1864&quot;, &quot;1865&quot;, &quot;1866&quot;, &quot;1867&quot;, &quot;1868&quot;, &quot;1869&quot;, &quot;1870&quot;, &quot;1871&quot;, &quot;1872&quot;, &quot;1873&quot;, &quot;1874&quot;, &quot;1875&quot;, &quot;1876&quot;, &quot;1926&quot;, &quot;1927&quot;, &quot;1928&quot;, &quot;1929&quot;, &quot;1930&quot;, &quot;1931&quot;, &quot;1932&quot;, &quot;1957&quot;, &quot;1958&quot;, &quot;10507&quot;, &quot;10508&quot;, &quot;10793&quot;, &quot;10794&quot;, &quot;10795&quot;, &quot;10796&quot;, &quot;10805&quot;, &quot;10806&quot;, &quot;10807&quot;, &quot;10808&quot;, &quot;10809&quot;, &quot;802360015&quot;, &quot;802360017&quot;, &quot;802360019&quot;, &quot;802360031&quot;, &quot;802360035&quot;, &quot;802360063&quot;, &quot;802360080&quot;, &quot;802360105&quot;, &quot;802360119&quot;, &quot;802360123&quot;, &quot;802360162&quot;, &quot;802360195&quot;, &quot;802360254&quot;, &quot;802360264&quot;, &quot;802360267&quot;, &quot;802360285&quot;, &quot;300652099&quot;, &quot;300652199&quot;, &quot;300652299&quot;, &quot;300652399&quot;, &quot;300652499&quot;)</span>
<span class="fc" id="L38">    val acxiomIbDemDefDf = acxiomIbDemDataframe.toDF(acxiomIbDemNewColumnNames: _*)</span>
<span class="fc" id="L39">    acxiomIbDemDefDf.createOrReplaceTempView(&quot;acxiomIb_dem_def_df_view&quot;)</span>

<span class="fc" id="L41">    var demoTableDf = spark.sql(&quot;SELECT consumer_pel, `1241`, `1242`, `1243`, `1637`, `1638`, `1639`, `1640`, `1645`, `1700`, `1701`, `1820`, `1821`, `1926`, `1927`, `1928`, `1929`, `1930`, `1931`, `1932`, `1957`, `1958`, `10507`, `10508`, `10793`, `10794`, `10795`, `10796`, `10805`, `10806`, `10807`, `10808`, `10809`, `802360015`, `802360017`, `802360019`, `802360031`, `802360035`, `802360063`, `802360080`, `802360105`, `802360119`, `802360123`, `802360162`, `802360195`, `802360254`, `802360264`, `802360267`, `802360285` ,`300652099`, `300652199`, `300652299`,`300652399`, `300652499`, NVL(`1836`,NVL(`1837`,NVL(`1838`,null))) AS age_18_23 , NVL(`1839`,NVL(`1840`,NVL(`1841`,null))) AS age_24_29 , NVL(`1842`,NVL(`1843`,NVL(`1844`,null))) AS age_30_35 , NVL(`1845`,NVL(`1846`,NVL(`1847`,null))) AS age_36_41 , NVL(`1848`,NVL(`1849`,NVL(`1850`,null))) AS age_42_47 , NVL(`1851`,NVL(`1852`,NVL(`1853`,null))) AS age_48_53 , NVL(`1854`,NVL(`1855`,NVL(`1856`,null))) AS age_54_59 , NVL(`1857`,NVL(`1858`,NVL(`1859`,null))) AS age_60_65 , NVL(`1860`,NVL(`1861`,NVL(`1862`,null))) AS age_66_71 , NVL(`1863`,NVL(`1864`,NVL(`1865`,null))) AS age_72_77 , NVL(`1866`,NVL(`1867`,NVL(`1868`,null))) AS age_78_83 , NVL(`1869`,NVL(`1870`,NVL(`1871`,NVL(`1872`,NVL(`1873`,NVL(`1874`,NVL(`1875`,NVL(`1876`,null)))))))) AS age_84_99 FROM acxiomIb_dem_def_df_view&quot;)</span>
<span class="fc" id="L42">    demoTableDf.createOrReplaceTempView(&quot;demo_table_df_view&quot;)</span>

<span class="fc" id="L44">    var acxiomIbFinDfPath = acxiomPath + &quot;/ib_finance_2019_q4/&quot;</span>
<span class="fc" id="L45">    val acxiomIbFinDataframe = spark.read.parquet(acxiomIbFinDfPath).select(&quot;consumer_pel&quot;, &quot;finance_cc_type_bank&quot;, &quot;finance_cc_type_gas_or_dept_or_retail&quot;, &quot;finance_cc_type_travel_or_ent&quot;, &quot;finance_cc_type_unknown&quot;, &quot;finance_cc_type_premium&quot;, &quot;finance_cc_type_upscale&quot;, &quot;finance_credit_card_user&quot;, &quot;finance_cc_mthly_1001_1500&quot;, &quot;finance_cc_mthly_35&quot;, &quot;finance_cc_mthly_36_55&quot;, &quot;finance_cc_mthly_91_110&quot;, &quot;finance_cc_mthly_181_225&quot;, &quot;finance_cc_mthly_226_450&quot;, &quot;finance_cc_mthly_451_700&quot;, &quot;finance_cc_mthly_701_1000&quot;, &quot;finance_cc_mthly_1501_2000&quot;, &quot;finance_cc_mthly_2Kplus&quot;)</span>
<span class="fc" id="L46">    val acxiomIbFinNewColumnNames = Seq(&quot;consumer_pel&quot;, &quot;1813&quot;, &quot;1814&quot;, &quot;1815&quot;, &quot;1816&quot;, &quot;1817&quot;, &quot;1818&quot;, &quot;1960&quot;, &quot;300490499&quot;, &quot;300490599&quot;, &quot;300490699&quot;, &quot;300490799&quot;, &quot;300490899&quot;, &quot;300490999&quot;, &quot;300491099&quot;, &quot;300491199&quot;, &quot;300491299&quot;, &quot;300491399&quot;)</span>
<span class="fc" id="L47">    val acxiomIbFinDefDf = acxiomIbFinDataframe.toDF(acxiomIbFinNewColumnNames: _*)</span>
<span class="fc" id="L48">    acxiomIbFinDefDf.createOrReplaceTempView(&quot;acxiomIb_fin_def_df_view&quot;)</span>

<span class="fc" id="L50">    var acxiomIbGeoDfPath = acxiomPath + &quot;/ib_geo_2019_q4/&quot;</span>
<span class="fc" id="L51">    val acxiomIbGeoDataframe = spark.read.parquet(acxiomIbGeoDfPath).select(&quot;consumer_pel&quot;, &quot;geo_dma_abilene_sweetwater&quot;, &quot;geo_dma_albany_ga&quot;, &quot;geo_dma_albany_schenectady&quot;, &quot;geo_dma_albuquerque_santa_fe&quot;, &quot;geo_dma_alexandria_la&quot;, &quot;geo_dma_alpena&quot;, &quot;geo_dma_amarillo&quot;, &quot;geo_dma_anchorage&quot;, &quot;geo_dma_atlanta&quot;, &quot;geo_dma_augusta_aiken&quot;, &quot;geo_dma_austin&quot;, &quot;geo_dma_bakersfield&quot;, &quot;geo_dma_baltimore&quot;, &quot;geo_dma_bangor&quot;, &quot;geo_dma_baton_rouge&quot;, &quot;geo_dma_beaumont_port_arthur&quot;, &quot;geo_dma_bend_or&quot;, &quot;geo_dma_billings&quot;, &quot;geo_dma_biloxi_gulfport&quot;, &quot;geo_dma_binghamton&quot;, &quot;geo_dma_birmingham&quot;, &quot;geo_dma_bluefield_beckley&quot;, &quot;geo_dma_boise&quot;, &quot;geo_dma_boston&quot;, &quot;geo_dma_bowling_green&quot;, &quot;geo_dma_buffalo&quot;, &quot;geo_dma_burlington_plattsburgh&quot;, &quot;geo_dma_butte_bozeman&quot;, &quot;geo_dma_casper_riverton&quot;, &quot;geo_dma_cedar_rapids&quot;, &quot;geo_dma_champaign_springfield&quot;, &quot;geo_dma_charleston_sc&quot;, &quot;geo_dma_charleston_huntington&quot;, &quot;geo_dma_charlotte&quot;, &quot;geo_dma_charlottesville&quot;, &quot;geo_dma_chattanooga&quot;, &quot;geo_dma_cheyenne_scottsbluff&quot;, &quot;geo_dma_chicago&quot;, &quot;geo_dma_chico_redding&quot;, &quot;geo_dma_cincinnati&quot;, &quot;geo_dma_clarksburg_weston&quot;, &quot;geo_dma_cleveland_akron&quot;, &quot;geo_dma_colorado_springs_pueblo&quot;, &quot;geo_dma_columbia_sc&quot;, &quot;geo_dma_columbia_jefferson_city&quot;, &quot;geo_dma_columbus_ga&quot;, &quot;geo_dma_columbus_oh&quot;, &quot;geo_dma_columbus_tupelo&quot;, &quot;geo_dma_corpus_christi&quot;, &quot;geo_dma_dallas_ft_worth&quot;, &quot;geo_dma_davenport_island_moline&quot;, &quot;geo_dma_dayton&quot;, &quot;geo_dma_denver&quot;, &quot;geo_dma_des_moines_ames&quot;, &quot;geo_dma_detroit&quot;, &quot;geo_dma_dothan&quot;, &quot;geo_dma_duluth_superior&quot;, &quot;geo_dma_el_aso&quot;, &quot;geo_dma_elmira&quot;, &quot;geo_dma_erie&quot;, &quot;geo_dma_eugene&quot;, &quot;geo_dma_eureka&quot;, &quot;geo_dma_evansville&quot;, &quot;geo_dma_fairbanks&quot;, &quot;geo_dma_fargo_valley_city&quot;, &quot;geo_dma_flint_saginaw&quot;, &quot;geo_dma_fresno_visalia&quot;, &quot;geo_dma_ft_myers_naples&quot;, &quot;geo_dma_ft_smith_fay&quot;, &quot;geo_dma_ft_wayne&quot;, &quot;geo_dma_gainesville&quot;, &quot;geo_dma_glendive&quot;, &quot;geo_dma_grand_junction_montrose&quot;, &quot;geo_dma_grand_rapids_kalmzoo&quot;, &quot;geo_dma_great_falls&quot;, &quot;geo_dma_green_bay_appleton&quot;, &quot;geo_dma_greensboro_hpoint&quot;, &quot;geo_dma_greenville_nbern_washngtn&quot;, &quot;geo_dma_greenvll_spart&quot;, &quot;geo_dma_greenwood_greenville&quot;, &quot;geo_dma_harlingen_wslco&quot;, &quot;geo_dma_harrisburg_lncstr&quot;, &quot;geo_dma_harrisonburg&quot;, &quot;geo_dma_hartford_new_haven&quot;, &quot;geo_dma_hattiesburg_laurel&quot;, &quot;geo_dma_helena&quot;, &quot;geo_dma_honolulu&quot;, &quot;geo_dma_houston&quot;, &quot;geo_dma_huntsville_decatur&quot;, &quot;geo_dma_idaho_fals_pocatllo&quot;, &quot;geo_dma_indianapolis&quot;, &quot;geo_dma_jackson_ms&quot;, &quot;geo_dma_jackson_tn&quot;, &quot;geo_dma_jacksonville&quot;, &quot;geo_dma_johnstown_altoona&quot;, &quot;geo_dma_jonesboro&quot;, &quot;geo_dma_joplin_pittsburg&quot;, &quot;geo_dma_juneau&quot;, &quot;geo_dma_kansas_city&quot;, &quot;geo_dma_knoxville&quot;, &quot;geo_dma_la_crosse_eau_claire&quot;, &quot;geo_dma_lafayette_in&quot;, &quot;geo_dma_lafayette_la&quot;, &quot;geo_dma_lake_charles&quot;, &quot;geo_dma_lansing&quot;, &quot;geo_dma_laredo&quot;, &quot;geo_dma_las_vegas&quot;, &quot;geo_dma_lexington&quot;, &quot;geo_dma_lima&quot;, &quot;geo_dma_lincoln_hastings_krny&quot;, &quot;geo_dma_little_rock_pine_bluff&quot;, &quot;geo_dma_los_angeles&quot;, &quot;geo_dma_louisville&quot;, &quot;geo_dma_lubbock&quot;, &quot;geo_dma_macon&quot;, &quot;geo_dma_madison&quot;, &quot;geo_dma_mankato&quot;, &quot;geo_dma_marquette&quot;, &quot;geo_dma_medford_klamath_falls&quot;, &quot;geo_dma_memphis&quot;, &quot;geo_dma_meridian&quot;, &quot;geo_dma_miami_ft_lauderdale&quot;, &quot;geo_dma_milwaukee&quot;, &quot;geo_dma_minneapolis_st_paul&quot;, &quot;geo_dma_minot_bsmrck&quot;, &quot;geo_dma_missoula&quot;, &quot;geo_dma_mobile_pensacola&quot;, &quot;geo_dma_monroe_el_dorado&quot;, &quot;geo_dma_monterey_salinas&quot;, &quot;geo_dma_montgomery_selma&quot;, &quot;geo_dma_myrtle_beach_florence&quot;, &quot;geo_dma_nashville&quot;, &quot;geo_dma_new_orleans&quot;, &quot;geo_dma_new_york&quot;, &quot;geo_dma_norfolk_portsmth&quot;, &quot;geo_dma_north_platte&quot;, &quot;geo_dma_odessa_midland&quot;, &quot;geo_dma_oklahoma_city&quot;, &quot;geo_dma_omaha&quot;, &quot;geo_dma_orlando_daytona&quot;, &quot;geo_dma_ottumwa_kirksville&quot;, &quot;geo_dma_paducah_cape_girard&quot;, &quot;geo_dma_palm_springs&quot;, &quot;geo_dma_panama_city&quot;, &quot;geo_dma_parkersburg&quot;, &quot;geo_dma_peoria_bloomington&quot;, &quot;geo_dma_philadelphia&quot;, &quot;geo_dma_phoenix&quot;, &quot;geo_dma_pittsburgh&quot;, &quot;geo_dma_portland_or&quot;, &quot;geo_dma_portland_auburn&quot;, &quot;geo_dma_presque_isle&quot;, &quot;geo_dma_providence_new_bedford&quot;, &quot;geo_dma_quincy_hannibal&quot;, &quot;geo_dma_raleigh_durham&quot;, &quot;geo_dma_rapid_city&quot;, &quot;geo_dma_reno&quot;, &quot;geo_dma_richmond_petersburg&quot;, &quot;geo_dma_roanoke_lynchburg&quot;, &quot;geo_dma_rochester_ny&quot;, &quot;geo_dma_rochestr_mason_city&quot;, &quot;geo_dma_rockford&quot;, &quot;geo_dma_sacramnto_stkton&quot;, &quot;geo_dma_salisbury&quot;, &quot;geo_dma_salt_lake_city&quot;, &quot;geo_dma_san_angelo&quot;, &quot;geo_dma_san_antonio&quot;, &quot;geo_dma_san_diego&quot;, &quot;geo_dma_san_francisco_oak_san_jose&quot;, &quot;geo_dma_santabarbra_sanmar&quot;, &quot;geo_dma_savannah&quot;, &quot;geo_dma_seattle_tacoma&quot;, &quot;geo_dma_sherman_ada&quot;, &quot;geo_dma_shreveport&quot;, &quot;geo_dma_sioux_city&quot;, &quot;geo_dma_sioux&quot;, &quot;geo_dma_south_bend_elkhart&quot;, &quot;geo_dma_spokane&quot;, &quot;geo_dma_springfield_mo&quot;, &quot;geo_dma_springfield_holyoke&quot;, &quot;geo_dma_st_joseph&quot;, &quot;geo_dma_st_louis&quot;, &quot;geo_dma_syracuse&quot;, &quot;geo_dma_tallahassee_thomasville&quot;, &quot;geo_dma_tampa_stpete&quot;, &quot;geo_dma_terre_haute&quot;, &quot;geo_dma_toledo&quot;, &quot;geo_dma_topeka&quot;, &quot;geo_dma_traverse_city_cadillac&quot;, &quot;geo_dma_tri_cities__tn_va&quot;, &quot;geo_dma_tucson&quot;, &quot;geo_dma_tulsa&quot;, &quot;geo_dma_twin_falls&quot;, &quot;geo_dma_tyler_longview&quot;, &quot;geo_dma_utica&quot;, &quot;geo_dma_victoria&quot;, &quot;geo_dma_waco_temple_bryan&quot;, &quot;geo_dma_washington_dc&quot;, &quot;geo_dma_watertown&quot;, &quot;geo_dma_wausau_rhinelander&quot;, &quot;geo_dma_west_palm_beach_ft_pierce&quot;, &quot;geo_dma_wheeling_steubenville&quot;, &quot;geo_dma_wichita_falls_lawton&quot;, &quot;geo_dma_wichita_hutchinson&quot;, &quot;geo_dma_wilkes_barre_scranton&quot;, &quot;geo_dma_wilmington&quot;, &quot;geo_dma_yakima_pasco&quot;, &quot;geo_dma_youngstown&quot;, &quot;geo_dma_yuma_el_centro&quot;, &quot;geo_dma_zanesville&quot;)</span>
<span class="fc" id="L52">    val acxiomIbGeoNewColumnNames = Seq(&quot;consumer_pel&quot;, &quot;18633&quot;, &quot;18634&quot;, &quot;18635&quot;, &quot;18636&quot;, &quot;18637&quot;, &quot;18638&quot;, &quot;18639&quot;, &quot;18640&quot;, &quot;18641&quot;, &quot;18642&quot;, &quot;18643&quot;, &quot;18644&quot;, &quot;18645&quot;, &quot;18646&quot;, &quot;18647&quot;, &quot;18648&quot;, &quot;18649&quot;, &quot;18650&quot;, &quot;18651&quot;, &quot;18652&quot;, &quot;18653&quot;, &quot;18654&quot;, &quot;18655&quot;, &quot;18656&quot;, &quot;18657&quot;, &quot;18658&quot;, &quot;18659&quot;, &quot;18660&quot;, &quot;18661&quot;, &quot;18662&quot;, &quot;18663&quot;, &quot;18664&quot;, &quot;18665&quot;, &quot;18666&quot;, &quot;18667&quot;, &quot;18668&quot;, &quot;18669&quot;, &quot;18670&quot;, &quot;18671&quot;, &quot;18672&quot;, &quot;18673&quot;, &quot;18674&quot;, &quot;18675&quot;, &quot;18676&quot;, &quot;18677&quot;, &quot;18678&quot;, &quot;18679&quot;, &quot;18680&quot;, &quot;18681&quot;, &quot;18682&quot;, &quot;18683&quot;, &quot;18684&quot;, &quot;18685&quot;, &quot;18686&quot;, &quot;18687&quot;, &quot;18688&quot;, &quot;18689&quot;, &quot;18690&quot;, &quot;18691&quot;, &quot;18692&quot;, &quot;18693&quot;, &quot;18694&quot;, &quot;18695&quot;, &quot;18696&quot;, &quot;18697&quot;, &quot;18698&quot;, &quot;18699&quot;, &quot;18700&quot;, &quot;18701&quot;, &quot;18702&quot;, &quot;18703&quot;, &quot;18704&quot;, &quot;18705&quot;, &quot;18706&quot;, &quot;18707&quot;, &quot;18708&quot;, &quot;18709&quot;, &quot;18710&quot;, &quot;18711&quot;, &quot;18712&quot;, &quot;18713&quot;, &quot;18714&quot;, &quot;18715&quot;, &quot;18716&quot;, &quot;18717&quot;, &quot;18718&quot;, &quot;18719&quot;, &quot;18720&quot;, &quot;18721&quot;, &quot;18722&quot;, &quot;18723&quot;, &quot;18724&quot;, &quot;18725&quot;, &quot;18726&quot;, &quot;18727&quot;, &quot;18728&quot;, &quot;18729&quot;, &quot;18730&quot;, &quot;18731&quot;, &quot;18732&quot;, &quot;18733&quot;, &quot;18734&quot;, &quot;18735&quot;, &quot;18736&quot;, &quot;18737&quot;, &quot;18738&quot;, &quot;18739&quot;, &quot;18740&quot;, &quot;18741&quot;, &quot;18742&quot;, &quot;18743&quot;, &quot;18744&quot;, &quot;18745&quot;, &quot;18746&quot;, &quot;18747&quot;, &quot;18748&quot;, &quot;18749&quot;, &quot;18750&quot;, &quot;18751&quot;, &quot;18752&quot;, &quot;18753&quot;, &quot;18754&quot;, &quot;18755&quot;, &quot;18756&quot;, &quot;18757&quot;, &quot;18758&quot;, &quot;18759&quot;, &quot;18760&quot;, &quot;18761&quot;, &quot;18762&quot;, &quot;18763&quot;, &quot;18764&quot;, &quot;18765&quot;, &quot;18766&quot;, &quot;18767&quot;, &quot;18768&quot;, &quot;18769&quot;, &quot;18770&quot;, &quot;18771&quot;, &quot;18772&quot;, &quot;18773&quot;, &quot;18774&quot;, &quot;18775&quot;, &quot;18776&quot;, &quot;18777&quot;, &quot;18778&quot;, &quot;18779&quot;, &quot;18780&quot;, &quot;18781&quot;, &quot;18782&quot;, &quot;18783&quot;, &quot;18784&quot;, &quot;18785&quot;, &quot;18786&quot;, &quot;18787&quot;, &quot;18788&quot;, &quot;18789&quot;, &quot;18790&quot;, &quot;18791&quot;, &quot;18792&quot;, &quot;18793&quot;, &quot;18794&quot;, &quot;18795&quot;, &quot;18796&quot;, &quot;18797&quot;, &quot;18798&quot;, &quot;18799&quot;, &quot;18800&quot;, &quot;18801&quot;, &quot;18802&quot;, &quot;18803&quot;, &quot;18804&quot;, &quot;18805&quot;, &quot;18806&quot;, &quot;18807&quot;, &quot;18808&quot;, &quot;18809&quot;, &quot;18810&quot;, &quot;18811&quot;, &quot;18812&quot;, &quot;18813&quot;, &quot;18814&quot;, &quot;18815&quot;, &quot;18816&quot;, &quot;18817&quot;, &quot;18818&quot;, &quot;18819&quot;, &quot;18820&quot;, &quot;18821&quot;, &quot;18822&quot;, &quot;18823&quot;, &quot;18824&quot;, &quot;18825&quot;, &quot;18826&quot;, &quot;18827&quot;, &quot;18828&quot;, &quot;18829&quot;, &quot;18830&quot;, &quot;18831&quot;, &quot;18832&quot;, &quot;18833&quot;, &quot;18834&quot;, &quot;18835&quot;, &quot;18836&quot;, &quot;18837&quot;, &quot;18838&quot;, &quot;18839&quot;, &quot;18840&quot;, &quot;18841&quot;, &quot;18842&quot;)</span>
<span class="fc" id="L53">    val acxiomIbGeoDefDf = acxiomIbGeoDataframe.toDF(acxiomIbGeoNewColumnNames: _*)</span>
<span class="fc" id="L54">    acxiomIbGeoDefDf.createOrReplaceTempView(&quot;acxiomIb_geo_def_df_view&quot;)</span>

<span class="fc" id="L56">    val uniquekeys = spark.read.parquet(acxiomKeysPath)</span>
<span class="fc" id="L57">    uniquekeys.createOrReplaceTempView(&quot;uniquekeys_view&quot;)</span>

<span class="fc" id="L59">    var acxiomIbHomeDfPath = acxiomPath + &quot;/ib_home_2019_q4/&quot;</span>
<span class="fc" id="L60">    val acxiomIbHomeDataframe = spark.read.parquet(acxiomIbHomeDfPath).select(&quot;consumer_pel&quot;, &quot;home_property_type_apartment&quot;, &quot;home_property_type_condo&quot;, &quot;home_property_type_single&quot;, &quot;home_market_value_gt_100K&quot;, &quot;home_market_value_100K_200K&quot;, &quot;home_market_value_200K_300K&quot;, &quot;home_market_value_300K_500K&quot;, &quot;home_market_value_500K_1M&quot;, &quot;home_market_value_1Mplus&quot;)</span>
<span class="fc" id="L61">    val acxiomIbHomeNewColumnNames = Seq(&quot;consumer_pel&quot;, &quot;1832&quot;, &quot;1833&quot;, &quot;1834&quot;, &quot;10868&quot;, &quot;10869&quot;, &quot;10870&quot;, &quot;10871&quot;, &quot;10872&quot;, &quot;10873&quot;)</span>
<span class="fc" id="L62">    val acxiomIbHomeDf = acxiomIbHomeDataframe.toDF(acxiomIbHomeNewColumnNames: _*)</span>

<span class="fc" id="L64">    val acxiomIbHomeDefDf = uniquekeys.join(acxiomIbHomeDf, uniquekeys(&quot;mbid_value&quot;) === acxiomIbHomeDf(&quot;consumer_pel&quot;), &quot;inner&quot;).withColumnRenamed(&quot;mbid&quot;, &quot;numericId1&quot;).select(&quot;numericId1&quot;, &quot;consumer_pel&quot;, &quot;10869&quot;, &quot;10873&quot;, &quot;10870&quot;, &quot;10871&quot;, &quot;10872&quot;, &quot;10868&quot;, &quot;1832&quot;, &quot;1833&quot;, &quot;1834&quot;)</span>
<span class="fc" id="L65">    acxiomIbHomeDefDf.createOrReplaceTempView(&quot;acxiomIb_home_def_df_view&quot;)</span>

<span class="fc" id="L67">    var acxiomIbInvDfPath = acxiomPath + &quot;/ib_invest_2019_q4/&quot;</span>
<span class="fc" id="L68">    val acxiomIbInvDataframe = spark.read.parquet(acxiomIbInvDfPath).select(&quot;consumer_pel&quot;, &quot;invest_segment_enviables&quot;, &quot;invest_segment_affluent_couples_or_singles&quot;, &quot;invest_segment_affluent_families_with_children&quot;, &quot;invest_segment_affluent_pre_retired&quot;, &quot;invest_segment_mainstream_couples_or_singles&quot;, &quot;invest_segment_mainstream_families_with_children&quot;, &quot;invest_segment_mainstream_pre_retired&quot;, &quot;invest_segment_luxury_seniors&quot;, &quot;invest_segment_comfortable_seniors&quot;, &quot;invest_segment_restrained_seniors&quot;, &quot;invest_segment_limiteds&quot;, &quot;invest_segment_starting_out&quot;)</span>
<span class="fc" id="L69">    val acxiomIbInvNewColumnNames = Seq(&quot;consumer_pel&quot;, &quot;300133801&quot;, &quot;300133802&quot;, &quot;300133803&quot;, &quot;300133804&quot;, &quot;300133805&quot;, &quot;300133806&quot;, &quot;300133807&quot;, &quot;300133808&quot;, &quot;300133809&quot;, &quot;300133810&quot;, &quot;300133811&quot;, &quot;300133812&quot;)</span>
<span class="fc" id="L70">    val acxiomIbInvDefDf = acxiomIbInvDataframe.toDF(acxiomIbInvNewColumnNames: _*)</span>
<span class="fc" id="L71">    acxiomIbInvDefDf.createOrReplaceTempView(&quot;acxiomIb_inv_def_df_view&quot;)</span>

<span class="fc" id="L73">    var acxiomIbLifDfPath = acxiomPath + &quot;/ib_lifestyle_2019_q4/&quot;</span>
<span class="fc" id="L74">    val acxiomIbLifDataframe = spark.read.parquet(acxiomIbLifDfPath).select(&quot;consumer_pel&quot;, &quot;lifestyle_personicx_lifestage_summit_estates&quot;, &quot;lifestyle_personicx_lifestage_established_elite&quot;, &quot;lifestyle_personicx_lifestage_corporate_connections&quot;, &quot;lifestyle_personicx_lifestage_top_professionals&quot;, &quot;lifestyle_personicx_lifestage_active_involved&quot;, &quot;lifestyle_personicx_lifestage_casual_comfort&quot;, &quot;lifestyle_personicx_lifestage_active_lifestyles&quot;, &quot;lifestyle_personicx_lifestage_solid_surroundings&quot;, &quot;lifestyle_personicx_lifestage_busy_schedules&quot;, &quot;lifestyle_personicx_lifestage_careers_travel&quot;, &quot;lifestyle_personicx_lifestage_schools_shopping&quot;, &quot;lifestyle_personicx_lifestage_on_go&quot;, &quot;lifestyle_personicx_lifestage_work_play&quot;, &quot;lifestyle_personicx_lifestage_career_centered&quot;, &quot;lifestyle_personicx_lifestage_country_ways&quot;, &quot;lifestyle_personicx_lifestage_country_enthusiasts&quot;, &quot;lifestyle_personicx_lifestage_firmly_established&quot;, &quot;lifestyle_personicx_lifestage_climbing_ladder&quot;, &quot;lifestyle_personicx_lifestage_country_comfort&quot;, &quot;lifestyle_personicx_lifestage_carving_time&quot;, &quot;lifestyle_personicx_lifestage_children_first&quot;, &quot;lifestyle_personicx_lifestage_comfortable_cornerstones&quot;, &quot;lifestyle_personicx_lifestage_good_neighbors&quot;, &quot;lifestyle_personicx_lifestage_career_building&quot;, &quot;lifestyle_personicx_lifestage_clubs_causes&quot;, &quot;lifestyle_personicx_lifestage_getting_established&quot;, &quot;lifestyle_personicx_lifestage_tenured_proprietors&quot;, &quot;lifestyle_personicx_lifestage_community_pillars&quot;, &quot;lifestyle_personicx_lifestage_city_mixers&quot;, &quot;lifestyle_personicx_lifestage_out_about&quot;, &quot;lifestyle_personicx_lifestage_mid_americana&quot;, &quot;lifestyle_personicx_lifestage_metro_mix&quot;, &quot;lifestyle_personicx_lifestage_urban_diversity&quot;, &quot;lifestyle_personicx_lifestage_outward_bound&quot;, &quot;lifestyle_personicx_lifestage_working_active&quot;, &quot;lifestyle_personicx_lifestage_persistent_productive&quot;, &quot;lifestyle_personicx_lifestage_firm_foundations&quot;, &quot;lifestyle_personicx_lifestage_occupational_mix&quot;, &quot;lifestyle_personicx_lifestage_setting_goals&quot;, &quot;lifestyle_personicx_lifestage_great_outdoors&quot;, &quot;lifestyle_personicx_lifestage_rural_adventure&quot;, &quot;lifestyle_personicx_lifestage_creative_variety&quot;, &quot;lifestyle_personicx_lifestage_work_causes&quot;, &quot;lifestyle_personicx_lifestage_open_houses&quot;, &quot;lifestyle_personicx_lifestage_offices_entertainment&quot;, &quot;lifestyle_personicx_lifestage_rural_active&quot;, &quot;lifestyle_personicx_lifestage_rural_parents&quot;, &quot;lifestyle_personicx_lifestage_farm_home&quot;, &quot;lifestyle_personicx_lifestage_home_garden&quot;, &quot;lifestyle_personicx_lifestage_rural_community&quot;, &quot;lifestyle_personicx_lifestage_role_models&quot;, &quot;lifestyle_personicx_lifestage_stylish_striving&quot;, &quot;lifestyle_personicx_lifestage_metro_strivers&quot;, &quot;lifestyle_personicx_lifestage_work_outdoors&quot;, &quot;lifestyle_personicx_lifestage_community_life&quot;, &quot;lifestyle_personicx_lifestage_metro_active&quot;, &quot;lifestyle_personicx_lifestage_collegiate_crowd&quot;, &quot;lifestyle_personicx_lifestage_outdoor_fervor&quot;, &quot;lifestyle_personicx_lifestage_mobile_mixers&quot;, &quot;lifestyle_personicx_lifestage_rural_mobile&quot;, &quot;lifestyle_personicx_lifestage_city_life&quot;, &quot;lifestyle_personicx_lifestage_movies_sports&quot;, &quot;lifestyle_personicx_lifestage_staying_home&quot;, &quot;lifestyle_personicx_lifestage_practical_careful&quot;, &quot;lifestyle_personicx_lifestage_hobbies_shopping&quot;, &quot;lifestyle_personicx_lifestage_helping_hands&quot;, &quot;lifestyle_personicx_lifestage_first_steps&quot;, &quot;lifestyle_personicx_lifestage_staying_healthy&quot;, &quot;lifestyle_personicx_lifestage_productive_havens&quot;, &quot;lifestyle_personicx_lifestage_favorably_frugal&quot;, &quot;lifestyle_personicx_insurance_secured_prosperity&quot;, &quot;lifestyle_personicx_insurance_stable_independence&quot;, &quot;lifestyle_personicx_insurance_establishing_priorities&quot;, &quot;lifestyle_personicx_insurance_thrifty_homeowners&quot;, &quot;lifestyle_personicx_insurance_thrifty_priorities&quot;, &quot;lifestyle_personicx_insurance_comfortable_renters&quot;, &quot;lifestyle_personicx_insurance_careful_planners&quot;, &quot;lifestyle_personicx_insurance_prosperous_households&quot;, &quot;lifestyle_personicx_insurance_personal_focus&quot;, &quot;lifestyle_personicx_insurance_modest_restraint&quot;, &quot;lifestyle_personicx_insurance_modest_country&quot;, &quot;lifestyle_personicx_insurance_aspiring_affluence&quot;, &quot;lifestyle_personicx_insurance_thrifty_renters&quot;, &quot;lifestyle_in_market_get_engaged&quot;, &quot;lifestyle_in_market_get_married&quot;, &quot;lifestyle_in_market_expect_grandchild&quot;, &quot;lifestyle_in_market_graduate_college&quot;, &quot;lifestyle_personicx_fin_involved_investors&quot;, &quot;lifestyle_personicx_fin_active_savers&quot;, &quot;lifestyle_personicx_fin_traditional_savers&quot;, &quot;lifestyle_personicx_fin_informed_control&quot;, &quot;lifestyle_personicx_fin_solid_investments&quot;, &quot;lifestyle_personicx_fin_hearth_home&quot;, &quot;lifestyle_personicx_fin_online_financiers&quot;, &quot;lifestyle_personicx_fin_investing_collections&quot;, &quot;lifestyle_personicx_fin_adventurous_investors&quot;, &quot;lifestyle_personicx_fin_comfortable_borrowers&quot;, &quot;lifestyle_personicx_fin_personal_service&quot;, &quot;lifestyle_personicx_fin_branded_influence&quot;, &quot;lifestyle_personicx_fin_asking_advice&quot;, &quot;lifestyle_personicx_fin_value_shoppers&quot;, &quot;lifestyle_personicx_fin_brand_variety&quot;, &quot;lifestyle_personicx_fin_online_automation&quot;, &quot;lifestyle_personicx_fin_online_learners&quot;, &quot;lifestyle_personicx_fin_trust_triumphs&quot;, &quot;lifestyle_personicx_fin_limited_traditionalists&quot;, &quot;lifestyle_personicx_fin_thrill_ride&quot;, &quot;lifestyle_personicx_fin_learn_prepare&quot;, &quot;lifestyle_personicx_fin_naturally_organized&quot;, &quot;lifestyle_personicx_fin_eye_economy&quot;, &quot;lifestyle_personicx_fin_daily_demands&quot;, &quot;lifestyle_personicx_fin_balance_vigilant&quot;, &quot;lifestyle_personicx_fin_comfort_zone&quot;, &quot;lifestyle_personicx_fin_online_managers&quot;, &quot;lifestyle_personicx_fin_quality_conscious&quot;, &quot;lifestyle_personicx_fin_traction_today&quot;, &quot;lifestyle_personicx_fin_in_moment&quot;, &quot;lifestyle_personicx_fin_collectors_clubs&quot;, &quot;lifestyle_personicx_fin_quality_price&quot;, &quot;lifestyle_personicx_fin_studied_purchasers&quot;, &quot;lifestyle_personicx_fin_deal_seekers&quot;, &quot;lifestyle_personicx_fin_worth_risk&quot;, &quot;lifestyle_personicx_fin_online_influencers&quot;, &quot;lifestyle_personicx_fin_sophisticated_environmentalists&quot;, &quot;lifestyle_personicx_fin_budget_optimists&quot;, &quot;lifestyle_personicx_fin_spontaneous_spenders&quot;, &quot;lifestyle_personicx_fin_coupon_cutters&quot;, &quot;lifestyle_personicx_fin_fluent_advisors&quot;, &quot;lifestyle_personicx_fin__freewheelers&quot;, &quot;lifestyle_personicx_fin_real_recommendations&quot;, &quot;lifestyle_personicx_fin_civic_centered&quot;, &quot;lifestyle_personicx_fin_prestige_seekers&quot;, &quot;lifestyle_personicx_fin_informed_shoppers&quot;, &quot;lifestyle_personicx_fin_technology_trenders&quot;, &quot;lifestyle_personicx_fin_future_fundamentals&quot;, &quot;lifestyle_personicx_fin_online_leaders&quot;, &quot;lifestyle_personicx_fin_online_connectors&quot;, &quot;lifestyle_personicx_fin_traditional_moderation&quot;, &quot;lifestyle_personicx_fin_work_save&quot;, &quot;lifestyle_personicx_fin_temperate_technology&quot;, &quot;lifestyle_personicx_fin_independent_investors&quot;, &quot;lifestyle_personicx_digital_mobile_networkers&quot;, &quot;lifestyle_personicx_digital_fin_enthusiasts&quot;, &quot;lifestyle_personicx_digital_phones_shopping&quot;, &quot;lifestyle_personicx_digital_skilled_shoppers&quot;, &quot;lifestyle_personicx_digital_sporty_shoppers&quot;, &quot;lifestyle_personicx_digital_social_users&quot;, &quot;lifestyle_personicx_digital_mobile_enthusiasts&quot;, &quot;lifestyle_personicx_digital_digital_transition&quot;, &quot;lifestyle_personicx_digital_mobile_music&quot;, &quot;lifestyle_personicx_digital_resolute_shoppers&quot;, &quot;lifestyle_personicx_digital_online_professionals&quot;, &quot;lifestyle_personicx_digital_news_sports&quot;, &quot;lifestyle_personicx_digital_travel_enthusiasts&quot;, &quot;lifestyle_personicx_digital_toys_trips&quot;, &quot;lifestyle_personicx_digital_career_launchers&quot;, &quot;lifestyle_personicx_digital_social_recreation&quot;, &quot;lifestyle_personicx_digital_globally_connected&quot;, &quot;lifestyle_personicx_digital_ecom_influenced&quot;, &quot;lifestyle_personicx_digital_entertained_diversion&quot;, &quot;lifestyle_personicx_digital_click_buy&quot;, &quot;lifestyle_personicx_digital_smartly_invested&quot;, &quot;lifestyle_personicx_digital_weekend_diversion&quot;, &quot;lifestyle_personicx_digital_functional_fundamentals&quot;, &quot;lifestyle_personicx_digital_music_networking&quot;, &quot;lifestyle_personicx_digital_realtime_rurals&quot;, &quot;lifestyle_personicx_digital_metro_entertainment&quot;, &quot;lifestyle_personicx_digital_information_seekers&quot;, &quot;lifestyle_personicx_digital_digital_dollars&quot;, &quot;lifestyle_personicx_digital_sports_fans&quot;, &quot;lifestyle_personicx_digital_wise_investments&quot;, &quot;lifestyle_personicx_digital_rural_commerce&quot;, &quot;lifestyle_personicx_digital_rural_providers&quot;, &quot;lifestyle_personicx_digital_posts_purchases&quot;, &quot;lifestyle_personicx_digital_secured_spenders&quot;, &quot;lifestyle_personicx_digital_purposeful_pursuits&quot;, &quot;lifestyle_personicx_digital_focused_searchers&quot;, &quot;lifestyle_personicx_digital_rural_shoppers&quot;, &quot;lifestyle_personicx_digital_urban_weekenders&quot;, &quot;lifestyle_personicx_digital_dialup_restraint&quot;, &quot;lifestyle_personicx_digital_suburban_limits&quot;, &quot;lifestyle_personicx_digital_city_searchers&quot;, &quot;lifestyle_personicx_digital_assisted_connections&quot;, &quot;lifestyle_personicx_digital_community_access&quot;, &quot;lifestyle_personicx_digital_rural_restraint&quot;, &quot;lifestyle_personicx_digital_discerning_buyers&quot;, &quot;lifestyle_personicx_digital_savvy_investors&quot;, &quot;lifestyle_personicx_digital_traditional_channels&quot;, &quot;lifestyle_personicx_digital_non_rural&quot;, &quot;lifestyle_personicx_digital_conventional_contacts&quot;, &quot;lifestyle_personicx_digital_online_heavy_users&quot;, &quot;lifestyle_personicx_digital_online_moderate_users&quot;, &quot;lifestyle_personicx_digital_online_super_users&quot;)</span>
<span class="fc" id="L75">    val acxiomIbLifNewColumnNames = Seq(&quot;consumer_pel&quot;, &quot;1004&quot;, &quot;1005&quot;, &quot;1006&quot;, &quot;1007&quot;, &quot;1008&quot;, &quot;1009&quot;, &quot;1010&quot;, &quot;1011&quot;, &quot;1012&quot;, &quot;1013&quot;, &quot;1014&quot;, &quot;1015&quot;, &quot;1016&quot;, &quot;1017&quot;, &quot;1018&quot;, &quot;1019&quot;, &quot;1020&quot;, &quot;1021&quot;, &quot;1022&quot;, &quot;1023&quot;, &quot;1024&quot;, &quot;1025&quot;, &quot;1026&quot;, &quot;1027&quot;, &quot;1028&quot;, &quot;1029&quot;, &quot;1030&quot;, &quot;1031&quot;, &quot;1032&quot;, &quot;1033&quot;, &quot;1034&quot;, &quot;1035&quot;, &quot;1036&quot;, &quot;1037&quot;, &quot;1038&quot;, &quot;1039&quot;, &quot;1040&quot;, &quot;1041&quot;, &quot;1042&quot;, &quot;1043&quot;, &quot;1044&quot;, &quot;1045&quot;, &quot;1046&quot;, &quot;1047&quot;, &quot;1048&quot;, &quot;1049&quot;, &quot;1050&quot;, &quot;1051&quot;, &quot;1052&quot;, &quot;1053&quot;, &quot;1054&quot;, &quot;1055&quot;, &quot;1056&quot;, &quot;1057&quot;, &quot;1058&quot;, &quot;1059&quot;, &quot;1060&quot;, &quot;1061&quot;, &quot;1062&quot;, &quot;1063&quot;, &quot;1064&quot;, &quot;1065&quot;, &quot;1066&quot;, &quot;1067&quot;, &quot;1068&quot;, &quot;1069&quot;, &quot;1070&quot;, &quot;1071&quot;, &quot;1072&quot;, &quot;1073&quot;, &quot;300127401&quot;, &quot;300127402&quot;, &quot;300127403&quot;, &quot;300127404&quot;, &quot;300127405&quot;, &quot;300127406&quot;, &quot;300127407&quot;, &quot;300127408&quot;, &quot;300127409&quot;, &quot;300127410&quot;, &quot;300127411&quot;, &quot;300127412&quot;, &quot;300127413&quot;, &quot;300437699&quot;, &quot;300437799&quot;, &quot;300438199&quot;, &quot;300440299&quot;, &quot;301127701&quot;, &quot;301127702&quot;, &quot;301127703&quot;, &quot;301127704&quot;, &quot;301127705&quot;, &quot;301127706&quot;, &quot;301127707&quot;, &quot;301127708&quot;, &quot;301127709&quot;, &quot;301127710&quot;, &quot;301127711&quot;, &quot;301127712&quot;, &quot;301127713&quot;, &quot;301127714&quot;, &quot;301127715&quot;, &quot;301127716&quot;, &quot;301127717&quot;, &quot;301127718&quot;, &quot;301127719&quot;, &quot;301127720&quot;, &quot;301127721&quot;, &quot;301127722&quot;, &quot;301127723&quot;, &quot;301127724&quot;, &quot;301127725&quot;, &quot;301127726&quot;, &quot;301127727&quot;, &quot;301127728&quot;, &quot;301127729&quot;, &quot;301127730&quot;, &quot;301127731&quot;, &quot;301127732&quot;, &quot;301127733&quot;, &quot;301127734&quot;, &quot;301127735&quot;, &quot;301127736&quot;, &quot;301127737&quot;, &quot;301127738&quot;, &quot;301127739&quot;, &quot;301127740&quot;, &quot;301127741&quot;, &quot;301127742&quot;, &quot;301127743&quot;, &quot;301127744&quot;, &quot;301127745&quot;, &quot;301127746&quot;, &quot;301127747&quot;, &quot;301127748&quot;, &quot;301127749&quot;, &quot;301127750&quot;, &quot;301127751&quot;, &quot;301127752&quot;, &quot;301127753&quot;, &quot;301127754&quot;, &quot;301128001&quot;, &quot;301128002&quot;, &quot;301128003&quot;, &quot;301128004&quot;, &quot;301128005&quot;, &quot;301128006&quot;, &quot;301128007&quot;, &quot;301128008&quot;, &quot;301128009&quot;, &quot;301128010&quot;, &quot;301128011&quot;, &quot;301128012&quot;, &quot;301128013&quot;, &quot;301128014&quot;, &quot;301128015&quot;, &quot;301128016&quot;, &quot;301128017&quot;, &quot;301128018&quot;, &quot;301128019&quot;, &quot;301128020&quot;, &quot;301128021&quot;, &quot;301128022&quot;, &quot;301128023&quot;, &quot;301128024&quot;, &quot;301128025&quot;, &quot;301128026&quot;, &quot;301128027&quot;, &quot;301128028&quot;, &quot;301128029&quot;, &quot;301128030&quot;, &quot;301128031&quot;, &quot;301128032&quot;, &quot;301128033&quot;, &quot;301128034&quot;, &quot;301128035&quot;, &quot;301128036&quot;, &quot;301128037&quot;, &quot;301128038&quot;, &quot;301128039&quot;, &quot;301128040&quot;, &quot;301128041&quot;, &quot;301128042&quot;, &quot;301128043&quot;, &quot;301128044&quot;, &quot;301128045&quot;, &quot;301128046&quot;, &quot;301128047&quot;, &quot;301128048&quot;, &quot;301128049&quot;, &quot;301128101&quot;, &quot;301128102&quot;, &quot;301128103&quot;)</span>
<span class="fc" id="L76">    val acxiomIbLifDefDf = acxiomIbLifDataframe.toDF(acxiomIbLifNewColumnNames: _*)</span>
<span class="fc" id="L77">    acxiomIbLifDefDf.createOrReplaceTempView(&quot;acxiomIb_lif_def_df_view&quot;)</span>

<span class="fc" id="L79">    var acxiomIbMedDfPath = acxiomPath + &quot;/ib_media_2019_q4/&quot;</span>
<span class="fc" id="L80">    val acxiomIbMedDataframe = spark.read.parquet(acxiomIbMedDfPath).select(&quot;consumer_pel&quot;, &quot;media_tv_watch_regularly_cooking_shows&quot;, &quot;media_tv_watch_regularly_documentaries&quot;, &quot;media_tv_watch_regularly_drama_shows&quot;, &quot;media_tv_watch_regularly_game_shows&quot;, &quot;media_tv_watch_regularly_home_improvement_shows&quot;, &quot;media_tv_watch_regularly_music_videos&quot;, &quot;media_tv_watch_regularly_auto_racing&quot;, &quot;media_tv_watch_regularly_news_shows&quot;, &quot;media_tv_watch_regularly_police_or_detective_shows&quot;, &quot;media_tv_watch_regularly_reality_television_shows&quot;, &quot;media_tv_watch_regularly_reality_religious_shows&quot;, &quot;media_tv_watch_regularly_situational_comedy_shows&quot;, &quot;media_tv_watch_regularly_soap_operas&quot;, &quot;media_tv_watch_regularly_sports_shows&quot;, &quot;media_tv_watch_regularly_talk_shows&quot;, &quot;media_tv_watch_regularly_wrestling_shows&quot;, &quot;media_channel_digital_display_ads&quot;, &quot;media_channel_online_video_ads&quot;, &quot;media_channel_use_ad_social_media&quot;, &quot;media_channel_listen_ad_radio&quot;, &quot;media_channel_read_print_ads&quot;, &quot;media_channel_exposed_ads_ooh&quot;, &quot;media_advertising_preference_online&quot;, &quot;media_advertising_preference_mobile&quot;, &quot;media_advertising_preference_primetime_tv&quot;, &quot;media_advertising_preference_daytime_tv&quot;, &quot;media_advertising_preference_outdoor&quot;, &quot;media_advertising_preference_yellow_pages&quot;, &quot;media_advertising_preference_radio&quot;, &quot;media_advertising_preference_magazine&quot;, &quot;media_advertising_preference_newspaper&quot;)</span>
<span class="fc" id="L81">    val acxiomIbMedNewColumnNames = Seq(&quot;consumer_pel&quot;, &quot;300478399&quot;, &quot;300478499&quot;, &quot;300478599&quot;, &quot;300478699&quot;, &quot;300478799&quot;, &quot;300478999&quot;, &quot;300479099&quot;, &quot;300479199&quot;, &quot;300479299&quot;, &quot;300479399&quot;, &quot;300479499&quot;, &quot;300479599&quot;, &quot;300479699&quot;, &quot;300479799&quot;, &quot;300479899&quot;, &quot;300479999&quot;, &quot;300622899&quot;, &quot;300622999&quot;, &quot;300623099&quot;, &quot;300623199&quot;, &quot;300623299&quot;, &quot;300623399&quot;, &quot;300358798&quot;, &quot;300358898&quot;, &quot;300358998&quot;, &quot;300359098&quot;, &quot;300359198&quot;, &quot;300359298&quot;, &quot;300359398&quot;, &quot;300359498&quot;, &quot;300359598&quot;)</span>
<span class="fc" id="L82">    val acxiomIbMedDefDf = acxiomIbMedDataframe.toDF(acxiomIbMedNewColumnNames: _*)</span>
<span class="fc" id="L83">    acxiomIbMedDefDf.createOrReplaceTempView(&quot;acxiomIb_med_def_df_view&quot;)</span>

<span class="fc" id="L85">    var acxiomIbRetDfPath = acxiomPath + &quot;/ib_retail_2019_q4/&quot;</span>
<span class="fc" id="L86">    val acxiomIbRetDataframe = spark.read.parquet(acxiomIbRetDfPath).select(&quot;consumer_pel&quot;, &quot;retail_segment_been_there_done_that&quot;, &quot;retail_segment_tight_with_purpose&quot;, &quot;retail_segment_full_spend_ahead&quot;, &quot;retail_segment_protecting_the_dream&quot;, &quot;retail_segment_eye_on_essentials&quot;, &quot;retail_segment_its_my_life&quot;, &quot;retail_segment_savvy_spenders&quot;, &quot;retail_segment_squeaking_by&quot;, &quot;retail_segment_reluctant_response&quot;)</span>
<span class="fc" id="L87">    val acxiomIbRetNewColumnNames = Seq(&quot;consumer_pel&quot;, &quot;300129101&quot;, &quot;300129102&quot;, &quot;300129103&quot;, &quot;300129104&quot;, &quot;300129105&quot;, &quot;300129106&quot;, &quot;300129107&quot;, &quot;300129108&quot;, &quot;300129109&quot;)</span>
<span class="fc" id="L88">    val acxiomIbRetDefDf = acxiomIbRetDataframe.toDF(acxiomIbRetNewColumnNames: _*)</span>
<span class="fc" id="L89">    acxiomIbRetDefDf.createOrReplaceTempView(&quot;acxiomIb_ret_def_df_view&quot;)</span>

    // Acxiom US Profile Report Generation Main Query //
<span class="fc" id="L92">    val colsList = List(&quot;1004&quot;, &quot;1005&quot;, &quot;1006&quot;, &quot;1007&quot;, &quot;1008&quot;, &quot;1009&quot;, &quot;1010&quot;, &quot;1011&quot;, &quot;1012&quot;, &quot;1013&quot;, &quot;1014&quot;, &quot;1015&quot;, &quot;1016&quot;, &quot;1017&quot;, &quot;1018&quot;, &quot;1019&quot;, &quot;1020&quot;, &quot;1021&quot;, &quot;1022&quot;, &quot;1023&quot;, &quot;1024&quot;, &quot;1025&quot;, &quot;1026&quot;, &quot;1027&quot;, &quot;1028&quot;, &quot;1029&quot;, &quot;1030&quot;, &quot;1031&quot;, &quot;1032&quot;, &quot;1033&quot;, &quot;1034&quot;, &quot;1035&quot;, &quot;1036&quot;, &quot;1037&quot;, &quot;1038&quot;, &quot;1039&quot;, &quot;1040&quot;, &quot;1041&quot;, &quot;1042&quot;, &quot;1043&quot;, &quot;1044&quot;, &quot;1045&quot;, &quot;1046&quot;, &quot;1047&quot;, &quot;1048&quot;, &quot;1049&quot;, &quot;1050&quot;, &quot;1051&quot;, &quot;1052&quot;, &quot;1053&quot;, &quot;1054&quot;, &quot;1055&quot;, &quot;1056&quot;, &quot;1057&quot;, &quot;1058&quot;, &quot;1059&quot;, &quot;1060&quot;, &quot;1061&quot;, &quot;1062&quot;, &quot;1063&quot;, &quot;1064&quot;, &quot;1065&quot;, &quot;1066&quot;, &quot;1067&quot;, &quot;1068&quot;, &quot;1069&quot;, &quot;1070&quot;, &quot;1071&quot;, &quot;1072&quot;, &quot;1073&quot;, &quot;1241&quot;, &quot;1242&quot;, &quot;1243&quot;, &quot;1637&quot;, &quot;1638&quot;, &quot;1639&quot;, &quot;1640&quot;, &quot;1645&quot;, &quot;1700&quot;, &quot;1701&quot;, &quot;1813&quot;, &quot;1814&quot;, &quot;1815&quot;, &quot;1816&quot;, &quot;1817&quot;, &quot;1818&quot;, &quot;1820&quot;, &quot;1821&quot;, &quot;1832&quot;, &quot;1833&quot;, &quot;1834&quot;, &quot;1926&quot;, &quot;1927&quot;, &quot;1928&quot;, &quot;1929&quot;, &quot;1930&quot;, &quot;1931&quot;, &quot;1932&quot;, &quot;1948&quot;, &quot;1957&quot;, &quot;1958&quot;, &quot;1960&quot;, &quot;2002&quot;, &quot;2005&quot;, &quot;2006&quot;, &quot;2007&quot;, &quot;2008&quot;, &quot;2009&quot;, &quot;2010&quot;, &quot;2013&quot;, &quot;2015&quot;, &quot;2017&quot;, &quot;2018&quot;, &quot;2020&quot;, &quot;2021&quot;, &quot;2022&quot;, &quot;2023&quot;, &quot;2024&quot;, &quot;2025&quot;, &quot;2026&quot;, &quot;2027&quot;, &quot;2028&quot;, &quot;2029&quot;, &quot;2030&quot;, &quot;2031&quot;, &quot;2033&quot;, &quot;2034&quot;, &quot;2035&quot;, &quot;2036&quot;, &quot;2038&quot;, &quot;2039&quot;, &quot;2040&quot;, &quot;2041&quot;, &quot;2042&quot;, &quot;2043&quot;, &quot;2046&quot;, &quot;2047&quot;, &quot;2048&quot;, &quot;2049&quot;, &quot;2050&quot;, &quot;2064&quot;, &quot;2065&quot;, &quot;2066&quot;, &quot;2067&quot;, &quot;2068&quot;, &quot;2069&quot;, &quot;2070&quot;, &quot;2071&quot;, &quot;2072&quot;, &quot;2073&quot;, &quot;2074&quot;, &quot;2075&quot;, &quot;2076&quot;, &quot;2077&quot;, &quot;2078&quot;, &quot;2079&quot;, &quot;2080&quot;, &quot;2081&quot;, &quot;2082&quot;, &quot;10507&quot;, &quot;10508&quot;, &quot;10739&quot;, &quot;10748&quot;, &quot;10749&quot;, &quot;10750&quot;, &quot;10751&quot;, &quot;10752&quot;, &quot;10753&quot;, &quot;10754&quot;, &quot;10755&quot;, &quot;10756&quot;, &quot;10793&quot;, &quot;10794&quot;, &quot;10795&quot;, &quot;10796&quot;, &quot;10805&quot;, &quot;10806&quot;, &quot;10807&quot;, &quot;10808&quot;, &quot;10809&quot;, &quot;10868&quot;, &quot;10869&quot;, &quot;10870&quot;, &quot;10871&quot;, &quot;10872&quot;, &quot;10873&quot;, &quot;18633&quot;, &quot;18634&quot;, &quot;18635&quot;, &quot;18636&quot;, &quot;18637&quot;, &quot;18638&quot;, &quot;18639&quot;, &quot;18640&quot;, &quot;18641&quot;, &quot;18642&quot;, &quot;18643&quot;, &quot;18644&quot;, &quot;18645&quot;, &quot;18646&quot;, &quot;18647&quot;, &quot;18648&quot;, &quot;18649&quot;, &quot;18650&quot;, &quot;18651&quot;, &quot;18652&quot;, &quot;18653&quot;, &quot;18654&quot;, &quot;18655&quot;, &quot;18656&quot;, &quot;18657&quot;, &quot;18658&quot;, &quot;18659&quot;, &quot;18660&quot;, &quot;18661&quot;, &quot;18662&quot;, &quot;18663&quot;, &quot;18664&quot;, &quot;18665&quot;, &quot;18666&quot;, &quot;18667&quot;, &quot;18668&quot;, &quot;18669&quot;, &quot;18670&quot;, &quot;18671&quot;, &quot;18672&quot;, &quot;18673&quot;, &quot;18674&quot;, &quot;18675&quot;, &quot;18676&quot;, &quot;18677&quot;, &quot;18678&quot;, &quot;18679&quot;, &quot;18680&quot;, &quot;18681&quot;, &quot;18682&quot;, &quot;18683&quot;, &quot;18684&quot;, &quot;18685&quot;, &quot;18686&quot;, &quot;18687&quot;, &quot;18688&quot;, &quot;18689&quot;, &quot;18690&quot;, &quot;18691&quot;, &quot;18692&quot;, &quot;18693&quot;, &quot;18694&quot;, &quot;18695&quot;, &quot;18696&quot;, &quot;18697&quot;, &quot;18698&quot;, &quot;18699&quot;, &quot;18700&quot;, &quot;18701&quot;, &quot;18702&quot;, &quot;18703&quot;, &quot;18704&quot;, &quot;18705&quot;, &quot;18706&quot;, &quot;18707&quot;, &quot;18708&quot;, &quot;18709&quot;, &quot;18710&quot;, &quot;18711&quot;, &quot;18712&quot;, &quot;18713&quot;, &quot;18714&quot;, &quot;18715&quot;, &quot;18716&quot;, &quot;18717&quot;, &quot;18718&quot;, &quot;18719&quot;, &quot;18720&quot;, &quot;18721&quot;, &quot;18722&quot;, &quot;18723&quot;, &quot;18724&quot;, &quot;18725&quot;, &quot;18726&quot;, &quot;18727&quot;, &quot;18728&quot;, &quot;18729&quot;, &quot;18730&quot;, &quot;18731&quot;, &quot;18732&quot;, &quot;18733&quot;, &quot;18734&quot;, &quot;18735&quot;, &quot;18736&quot;, &quot;18737&quot;, &quot;18738&quot;, &quot;18739&quot;, &quot;18740&quot;, &quot;18741&quot;, &quot;18742&quot;, &quot;18743&quot;, &quot;18744&quot;, &quot;18745&quot;, &quot;18746&quot;, &quot;18747&quot;, &quot;18748&quot;, &quot;18749&quot;, &quot;18750&quot;, &quot;18751&quot;, &quot;18752&quot;, &quot;18753&quot;, &quot;18754&quot;, &quot;18755&quot;, &quot;18756&quot;, &quot;18757&quot;, &quot;18758&quot;, &quot;18759&quot;, &quot;18760&quot;, &quot;18761&quot;, &quot;18762&quot;, &quot;18763&quot;, &quot;18764&quot;, &quot;18765&quot;, &quot;18766&quot;, &quot;18767&quot;, &quot;18768&quot;, &quot;18769&quot;, &quot;18770&quot;, &quot;18771&quot;, &quot;18772&quot;, &quot;18773&quot;, &quot;18774&quot;, &quot;18775&quot;, &quot;18776&quot;, &quot;18777&quot;, &quot;18778&quot;, &quot;18779&quot;, &quot;18780&quot;, &quot;18781&quot;, &quot;18782&quot;, &quot;18783&quot;, &quot;18784&quot;, &quot;18785&quot;, &quot;18786&quot;, &quot;18787&quot;, &quot;18788&quot;, &quot;18789&quot;, &quot;18790&quot;, &quot;18791&quot;, &quot;18792&quot;, &quot;18793&quot;, &quot;18794&quot;, &quot;18795&quot;, &quot;18796&quot;, &quot;18797&quot;, &quot;18798&quot;, &quot;18799&quot;, &quot;18800&quot;, &quot;18801&quot;, &quot;18802&quot;, &quot;18803&quot;, &quot;18804&quot;, &quot;18805&quot;, &quot;18806&quot;, &quot;18807&quot;, &quot;18808&quot;, &quot;18809&quot;, &quot;18810&quot;, &quot;18811&quot;, &quot;18812&quot;, &quot;18813&quot;, &quot;18814&quot;, &quot;18815&quot;, &quot;18816&quot;, &quot;18817&quot;, &quot;18818&quot;, &quot;18819&quot;, &quot;18820&quot;, &quot;18821&quot;, &quot;18822&quot;, &quot;18823&quot;, &quot;18824&quot;, &quot;18825&quot;, &quot;18826&quot;, &quot;18827&quot;, &quot;18828&quot;, &quot;18829&quot;, &quot;18830&quot;, &quot;18831&quot;, &quot;18832&quot;, &quot;18833&quot;, &quot;18834&quot;, &quot;18835&quot;, &quot;18836&quot;, &quot;18837&quot;, &quot;18838&quot;, &quot;18839&quot;, &quot;18840&quot;, &quot;18841&quot;, &quot;18842&quot;, &quot;300002799&quot;, &quot;300008599&quot;, &quot;300025099&quot;, &quot;300025199&quot;, &quot;300025299&quot;, &quot;300025399&quot;, &quot;300025499&quot;, &quot;300025599&quot;, &quot;300026799&quot;, &quot;300026899&quot;, &quot;300026999&quot;, &quot;300027099&quot;, &quot;300027199&quot;, &quot;300027299&quot;, &quot;300027399&quot;, &quot;300027499&quot;, &quot;300027599&quot;, &quot;300027799&quot;, &quot;300027899&quot;, &quot;300027999&quot;, &quot;300028199&quot;, &quot;300028299&quot;, &quot;300028599&quot;, &quot;300127401&quot;, &quot;300127402&quot;, &quot;300127403&quot;, &quot;300127404&quot;, &quot;300127405&quot;, &quot;300127406&quot;, &quot;300127407&quot;, &quot;300127408&quot;, &quot;300127409&quot;, &quot;300127410&quot;, &quot;300127411&quot;, &quot;300127412&quot;, &quot;300127413&quot;, &quot;300129001&quot;, &quot;300129002&quot;, &quot;300129003&quot;, &quot;300129004&quot;, &quot;300129005&quot;, &quot;300129006&quot;, &quot;300129007&quot;, &quot;300129008&quot;, &quot;300129009&quot;, &quot;300129010&quot;, &quot;300129101&quot;, &quot;300129102&quot;, &quot;300129103&quot;, &quot;300129104&quot;, &quot;300129105&quot;, &quot;300129106&quot;, &quot;300129107&quot;, &quot;300129108&quot;, &quot;300129109&quot;, &quot;300133801&quot;, &quot;300133802&quot;, &quot;300133803&quot;, &quot;300133804&quot;, &quot;300133805&quot;, &quot;300133806&quot;, &quot;300133807&quot;, &quot;300133808&quot;, &quot;300133809&quot;, &quot;300133810&quot;, &quot;300133811&quot;, &quot;300133812&quot;, &quot;300437699&quot;, &quot;300437799&quot;, &quot;300438199&quot;, &quot;300440299&quot;, &quot;300441499&quot;, &quot;300441599&quot;, &quot;300448599&quot;, &quot;300448699&quot;, &quot;300448799&quot;, &quot;300448899&quot;, &quot;300448999&quot;, &quot;300449099&quot;, &quot;300449199&quot;, &quot;300449299&quot;, &quot;300449399&quot;, &quot;300449499&quot;, &quot;300449599&quot;, &quot;300449699&quot;, &quot;300449799&quot;, &quot;300449899&quot;, &quot;300449999&quot;, &quot;300450099&quot;, &quot;300450199&quot;, &quot;300450299&quot;, &quot;300450399&quot;, &quot;300450499&quot;, &quot;300450599&quot;, &quot;300450699&quot;, &quot;300450799&quot;, &quot;300450899&quot;, &quot;300450999&quot;, &quot;300451099&quot;, &quot;300451199&quot;, &quot;300451299&quot;, &quot;300451399&quot;, &quot;300451499&quot;, &quot;300451599&quot;, &quot;300451699&quot;, &quot;300451799&quot;, &quot;300451899&quot;, &quot;300451999&quot;, &quot;300452099&quot;, &quot;300452199&quot;, &quot;300452299&quot;, &quot;300452399&quot;, &quot;300452499&quot;, &quot;300452599&quot;, &quot;300452699&quot;, &quot;300452799&quot;, &quot;300452899&quot;, &quot;300452999&quot;, &quot;300453099&quot;, &quot;300453199&quot;, &quot;300453299&quot;, &quot;300453399&quot;, &quot;300453499&quot;, &quot;300453599&quot;, &quot;300453699&quot;, &quot;300453799&quot;, &quot;300453899&quot;, &quot;300453999&quot;, &quot;300454099&quot;, &quot;300454199&quot;, &quot;300454299&quot;, &quot;300454399&quot;, &quot;300454499&quot;, &quot;300454599&quot;, &quot;300454699&quot;, &quot;300454799&quot;, &quot;300454899&quot;, &quot;300454999&quot;, &quot;300455399&quot;, &quot;300455499&quot;, &quot;300455599&quot;, &quot;300455699&quot;, &quot;300455799&quot;, &quot;300455899&quot;, &quot;300455999&quot;, &quot;300456099&quot;, &quot;300456199&quot;, &quot;300456299&quot;, &quot;300456399&quot;, &quot;300456499&quot;, &quot;300456599&quot;, &quot;300456699&quot;, &quot;300456799&quot;, &quot;300456899&quot;, &quot;300456999&quot;, &quot;300457099&quot;, &quot;300457199&quot;, &quot;300457299&quot;, &quot;300457399&quot;, &quot;300457499&quot;, &quot;300457599&quot;, &quot;300457699&quot;, &quot;300457799&quot;, &quot;300457899&quot;, &quot;300457999&quot;, &quot;300458099&quot;, &quot;300478399&quot;, &quot;300478499&quot;, &quot;300478599&quot;, &quot;300478699&quot;, &quot;300478799&quot;, &quot;300478999&quot;, &quot;300479099&quot;, &quot;300479199&quot;, &quot;300479299&quot;, &quot;300479399&quot;, &quot;300479499&quot;, &quot;300479599&quot;, &quot;300479699&quot;, &quot;300479799&quot;, &quot;300479899&quot;, &quot;300479999&quot;, &quot;300490499&quot;, &quot;300490599&quot;, &quot;300490699&quot;, &quot;300490799&quot;, &quot;300490899&quot;, &quot;300490999&quot;, &quot;300491099&quot;, &quot;300491199&quot;, &quot;300491299&quot;, &quot;300491399&quot;, &quot;300528799&quot;, &quot;300528899&quot;, &quot;300528999&quot;, &quot;300529299&quot;, &quot;300610399&quot;, &quot;300610499&quot;, &quot;300610599&quot;, &quot;300610699&quot;, &quot;300611099&quot;, &quot;300611199&quot;, &quot;300611299&quot;, &quot;300611399&quot;, &quot;300614099&quot;, &quot;300614199&quot;, &quot;300614299&quot;, &quot;300614399&quot;, &quot;300614499&quot;, &quot;300614599&quot;, &quot;300614699&quot;, &quot;300614799&quot;, &quot;300614899&quot;, &quot;300614999&quot;, &quot;300615099&quot;, &quot;300615199&quot;, &quot;300615299&quot;, &quot;300622899&quot;, &quot;300622999&quot;, &quot;300623099&quot;, &quot;300623199&quot;, &quot;300623299&quot;, &quot;300623399&quot;, &quot;300624099&quot;, &quot;301127701&quot;, &quot;301127702&quot;, &quot;301127703&quot;, &quot;301127704&quot;, &quot;301127705&quot;, &quot;301127706&quot;, &quot;301127707&quot;, &quot;301127708&quot;, &quot;301127709&quot;, &quot;301127710&quot;, &quot;301127711&quot;, &quot;301127712&quot;, &quot;301127713&quot;, &quot;301127714&quot;, &quot;301127715&quot;, &quot;301127716&quot;, &quot;301127717&quot;, &quot;301127718&quot;, &quot;301127719&quot;, &quot;301127720&quot;, &quot;301127721&quot;, &quot;301127722&quot;, &quot;301127723&quot;, &quot;301127724&quot;, &quot;301127725&quot;, &quot;301127726&quot;, &quot;301127727&quot;, &quot;301127728&quot;, &quot;301127729&quot;, &quot;301127730&quot;, &quot;301127731&quot;, &quot;301127732&quot;, &quot;301127733&quot;, &quot;301127734&quot;, &quot;301127735&quot;, &quot;301127736&quot;, &quot;301127737&quot;, &quot;301127738&quot;, &quot;301127739&quot;, &quot;301127740&quot;, &quot;301127741&quot;, &quot;301127742&quot;, &quot;301127743&quot;, &quot;301127744&quot;, &quot;301127745&quot;, &quot;301127746&quot;, &quot;301127747&quot;, &quot;301127748&quot;, &quot;301127749&quot;, &quot;301127750&quot;, &quot;301127751&quot;, &quot;301127752&quot;, &quot;301127753&quot;, &quot;301127754&quot;, &quot;802360015&quot;, &quot;802360017&quot;, &quot;802360019&quot;, &quot;802360031&quot;, &quot;802360035&quot;, &quot;802360063&quot;, &quot;802360080&quot;, &quot;802360105&quot;, &quot;802360119&quot;, &quot;802360123&quot;, &quot;802360162&quot;, &quot;802360195&quot;, &quot;802360254&quot;, &quot;802360264&quot;, &quot;802360267&quot;, &quot;802360285&quot;, &quot;300358798&quot;, &quot;300358898&quot;, &quot;300358998&quot;, &quot;300359098&quot;, &quot;300359198&quot;, &quot;300359298&quot;, &quot;300359398&quot;, &quot;300359498&quot;, &quot;300359598&quot;, &quot;300652099&quot;, &quot;300652199&quot;, &quot;300652299&quot;, &quot;300652399&quot;, &quot;300652499&quot;, &quot;301128001&quot;, &quot;301128002&quot;, &quot;301128003&quot;, &quot;301128004&quot;, &quot;301128005&quot;, &quot;301128006&quot;, &quot;301128007&quot;, &quot;301128008&quot;, &quot;301128009&quot;, &quot;301128010&quot;, &quot;301128011&quot;, &quot;301128012&quot;, &quot;301128013&quot;, &quot;301128014&quot;, &quot;301128015&quot;, &quot;301128016&quot;, &quot;301128017&quot;, &quot;301128018&quot;, &quot;301128019&quot;, &quot;301128020&quot;, &quot;301128021&quot;, &quot;301128022&quot;, &quot;301128023&quot;, &quot;301128024&quot;, &quot;301128025&quot;, &quot;301128026&quot;, &quot;301128027&quot;, &quot;301128028&quot;, &quot;301128029&quot;, &quot;301128030&quot;, &quot;301128031&quot;, &quot;301128032&quot;, &quot;301128033&quot;, &quot;301128034&quot;, &quot;301128035&quot;, &quot;301128036&quot;, &quot;301128037&quot;, &quot;301128038&quot;, &quot;301128039&quot;, &quot;301128040&quot;, &quot;301128041&quot;, &quot;301128042&quot;, &quot;301128043&quot;, &quot;301128044&quot;, &quot;301128045&quot;, &quot;301128046&quot;, &quot;301128047&quot;, &quot;301128048&quot;, &quot;301128049&quot;, &quot;301128101&quot;, &quot;301128102&quot;, &quot;301128103&quot;, &quot;800904217&quot;, &quot;800904218&quot;, &quot;800904299&quot;, &quot;age_18_23&quot;, &quot;age_24_29&quot;, &quot;age_30_35&quot;, &quot;age_36_41&quot;, &quot;age_42_47&quot;, &quot;age_48_53&quot;, &quot;age_54_59&quot;, &quot;age_60_65&quot;, &quot;age_66_71&quot;, &quot;age_72_77&quot;, &quot;age_78_83&quot;, &quot;age_84_99&quot;)</span>

<span class="fc" id="L94">    var query1 = &quot;SELECT CAST(numericId1 as bigint) as numericId, &quot;</span>
<span class="fc" id="L95">    for (col &lt;- colsList) {</span>
<span class="fc" id="L96">      query1 += &quot;&quot;&quot; CAST(NVL(`&quot;&quot;&quot; + col + &quot;&quot;&quot;` ,'0') AS Byte) AS `&quot;&quot;&quot; + col + &quot;` ,&quot;</span>
    }

    //Code to Remove comma at the end of query
<span class="fc" id="L100">    query1 = query1.reverse.substring(2, query1.length()).reverse</span>
<span class="fc" id="L101">    val sqlSuffix = &quot; FROM acxiomIb_home_def_df_view home JOIN acxiomIb_inv_def_df_view invest ON (home.consumer_pel = invest.consumer_pel) JOIN acxiomIb_fin_def_df_view finance ON (home.consumer_pel = finance.consumer_pel) JOIN acxiomIb_ret_def_df_view retail ON (home.consumer_pel = retail.consumer_pel) JOIN acxiomIb_med_def_df_view media ON (home.consumer_pel = media.consumer_pel) JOIN demo_table_df_view demo ON (home.consumer_pel = demo.consumer_pel) JOIN acxiomIb_lif_def_df_view lifestyle ON (home.consumer_pel = lifestyle.consumer_pel) JOIN acxiomIb_geo_def_df_view geo ON (home.consumer_pel = geo.consumer_pel) JOIN acxiomIb_aut_def_df_view auto ON (home.consumer_pel = auto.consumer_pel) &quot;</span>
<span class="fc" id="L102">    query1 = query1 + sqlSuffix</span>
<span class="fc" id="L103">    val acxiomProfilesTableNameDf = spark.sql(query1)</span>

<span class="fc" id="L105">    acxiomProfilesTableNameDf.repartition(124).write.mode(SaveMode.Overwrite).option(MapRedFilOutComAlgVer, &quot;2&quot;).parquet(outputPath)</span>
  }

  def reportAcxiomAU(acxiomPath: String,
                     acxiomLiverampMapPath: String,
                     acxiomKeysPath: String,
                     acxiomFilterExpr: String,
                     dropColumns: Seq[String],
                     outputPath: String): Unit = {

<span class="pc bpc" id="L115" title="1 of 2 branches missed.">    val acxiomParquet = if (!acxiomFilterExpr.isEmpty) {</span>
<span class="nc" id="L116">      spark.read.parquet(acxiomPath).drop(dropColumns: _*).filter(acxiomFilterExpr).persist(StorageLevel.MEMORY_AND_DISK)</span>
    } else {
<span class="fc" id="L118">      spark.read.parquet(acxiomPath).drop(dropColumns: _*)</span>
    }

    // 2) ACXIOM_LIVERAMP_MAPPING_DATA_SOURCE
<span class="fc" id="L122">    val acxiomLiverampMapping = spark.read.parquet(acxiomLiverampMapPath)</span>
    // Columns - acxiom_id,liveramp_mbid

    // 3) JOIN acxiom_parquet to acxiom_liveramp_mapping
<span class="fc" id="L126">    val acxiomLiverampJoinedDf = acxiomParquet.join(acxiomLiverampMapping, acxiomParquet(&quot;acx_id&quot;) === acxiomLiverampMapping(&quot;acxiom_id&quot;), &quot;inner&quot;)</span>
<span class="fc" id="L127">    acxiomLiverampJoinedDf.createOrReplaceTempView(&quot;df1_view&quot;)</span>

<span class="fc" id="L129">    val acxiomKeys = spark.read.parquet(acxiomKeysPath)</span>
<span class="fc" id="L130">    acxiomKeys.createOrReplaceTempView(&quot;acxiom_keys_view&quot;)</span>

<span class="fc" id="L132">    val valuesList = List(&quot;01&quot;, &quot;02&quot;, &quot;03&quot;, &quot;04&quot;, &quot;05&quot;, &quot;06&quot;, &quot;07&quot;, &quot;08&quot;, &quot;09&quot;, &quot;10&quot;, &quot;11&quot;, &quot;12&quot;, &quot;13&quot;, &quot;14&quot;, &quot;15&quot;, &quot;16&quot;, &quot;17&quot;, &quot;18&quot;, &quot;19&quot;, &quot;20&quot;)</span>

<span class="fc" id="L134">    val colsList = List(&quot;accomodations_and_food_services&quot;, &quot;administration&quot;, &quot;age_band_0_4&quot;, &quot;age_band_15_19&quot;, &quot;age_band_20_24&quot;, &quot;age_band_25_34&quot;, &quot;age_band_35_44&quot;, &quot;age_band_45_54&quot;, &quot;age_band_5_14&quot;, &quot;age_band_55_64&quot;, &quot;age_band_65_74&quot;, &quot;age_band_75_84&quot;, &quot;age_band_85_plus&quot;, &quot;agriculture_and_fishing&quot;, &quot;arts_and_recreation&quot;, &quot;clerical_and_administration&quot;, &quot;college_or_graduate_institution&quot;, &quot;communication_and_personnel_workers&quot;, &quot;construction&quot;, &quot;education&quot;, &quot;education_unknown&quot;, &quot;finance_and_insurance&quot;, &quot;healthcare&quot;, &quot;household_income_10000_15000&quot;, &quot;household_income_130000_1500000&quot;, &quot;household_income_15000_20000&quot;, &quot;household_income_150000_180000&quot;, &quot;household_income_180000_200000&quot;, &quot;household_income_20000_30000&quot;, &quot;household_income_30000_40000&quot;, &quot;household_income_40000_50000&quot;, &quot;household_income_50000_65000&quot;, &quot;household_income_65000_80000&quot;, &quot;household_income_80000_130000&quot;, &quot;household_income_less_than_10000&quot;, &quot;household_income_more_than_200000&quot;, &quot;labor_force_not_stated&quot;, &quot;labourers&quot;, &quot;machine_operators_and_drivers&quot;, &quot;managers&quot;, &quot;manufacturing&quot;, &quot;media_and_telecommunications&quot;, &quot;mining&quot;, &quot;not_in_labor_force&quot;, &quot;occupation_unknown&quot;, &quot;other_educational_institution&quot;, &quot;other_services&quot;, &quot;professionals&quot;, &quot;public_administration_and_safety&quot;, &quot;real_estate&quot;, &quot;retail&quot;, &quot;sales&quot;, &quot;scientific_and_tech&quot;, &quot;tech_and_trade&quot;, &quot;technical_or_college_or_further_education&quot;, &quot;total_labor_force&quot;, &quot;transportation_and_warehousing&quot;, &quot;unemployed&quot;, &quot;unknown&quot;, &quot;wholesale&quot;, &quot;work_full_time&quot;, &quot;work_part_time&quot;)</span>

<span class="fc" id="L136">    var query1 = &quot;select CAST(numericId as bigint) as numericId, &quot;</span>
<span class="fc" id="L137">    for (col &lt;- colsList) {</span>
<span class="pc bpc" id="L138" title="1 of 2 branches missed.">      for (i &lt;- valuesList) {</span>
<span class="fc" id="L139">        query1 += &quot;&quot;&quot; cast(SUM(case when `&quot;&quot;&quot; + col + &quot;&quot;&quot;` IN ('&quot;&quot;&quot; + i + &quot;&quot;&quot;') then 1 else 0 end) as tinyint) as `&quot;&quot;&quot; + col + &quot;&quot;&quot;_&quot;&quot;&quot; + i + &quot;` , &quot;</span>
      }
    }

<span class="fc" id="L143">    query1 = query1.reverse.substring(2, query1.length()).reverse</span>
<span class="fc" id="L144">    val staticQuery = &quot;, cast(SUM(case when `age_band_modeled` in ('18-19') then 1 else 0 end) as tinyint) as `age_band_modeled_18-19`,cast(SUM(case when `age_band_modeled` in ('20-24') then 1 else 0 end) as tinyint) as `age_band_modeled_20-24`,cast(SUM(case when `age_band_modeled` in ('25-29') then 1 else 0 end) as tinyint) as `age_band_modeled_25-29`,cast(SUM(case when `age_band_modeled` in ('30-34') then 1 else 0 end) as tinyint) as `age_band_modeled_30-34`,cast(SUM(case when `age_band_modeled` in ('35-39') then 1 else 0 end) as tinyint) as `age_band_modeled_35-39`,cast(SUM(case when `age_band_modeled` in ('40-44') then 1 else 0 end) as tinyint) as `age_band_modeled_40-44`,cast(SUM(case when `age_band_modeled` in ('45-49') then 1 else 0 end) as tinyint) as `age_band_modeled_45-49`,cast(SUM(case when `age_band_modeled` in ('50-54') then 1 else 0 end) as tinyint) as `age_band_modeled_50-54`,cast(SUM(case when `age_band_modeled` in ('55-59') then 1 else 0 end) as tinyint) as `age_band_modeled_55-59`,cast(SUM(case when `age_band_modeled` in ('60-64') then 1 else 0 end) as tinyint) as `age_band_modeled_60-64`,cast(SUM(case when `age_band_modeled` in ('65-69') then 1 else 0 end) as tinyint) as `age_band_modeled_65-69`,cast(SUM(case when `age_band_modeled` in ('70-74') then 1 else 0 end) as tinyint) as `age_band_modeled_70-74`,cast(SUM(case when `age_band_modeled` in ('75-79') then 1 else 0 end) as tinyint) as `age_band_modeled_75-79`,cast(SUM(case when `age_band_modeled` in ('80-84') then 1 else 0 end) as tinyint) as `age_band_modeled_80-84`,cast(SUM(case when `age_band_modeled` in ('85+') then 1 else 0 end) as tinyint) as `age_band_modeled_85+` ,cast(SUM(case when `gender` in ('F','M','U') then 1 else 0 end) as tinyint) as `gender_F`,cast(SUM(case when `gender` in ('F','M','U') then 1 else 0 end) as tinyint) as `gender_M`,cast(SUM(case when `gender` in ('F','M','U') then 1 else 0 end) as tinyint) as `gender_U` ,cast(SUM(case when `household_relationship_code` in ('01') then 1 else 0 end) as tinyint) as `household_relationship_code_01`,cast(SUM(case when `household_relationship_code` in ('02') then 1 else 0 end) as tinyint) as `household_relationship_code_02`,cast(SUM(case when `household_relationship_code` in ('03') then 1 else 0 end) as tinyint) as `household_relationship_code_03`,cast(SUM(case when `household_relationship_code` in ('04') then 1 else 0 end) as tinyint) as `household_relationship_code_04`,cast(SUM(case when `household_relationship_code` in ('05') then 1 else 0 end) as tinyint) as `household_relationship_code_05`,cast(SUM(case when `household_relationship_code` in ('06') then 1 else 0 end) as tinyint) as `household_relationship_code_06`,cast(SUM(case when `household_relationship_code` in ('99') then 1 else 0 end) as tinyint) as `household_relationship_code_99`,cast(SUM(case when `income_range_modeled` in ('0-20799') then 1 else 0 end) as tinyint) as `income_range_modeled_0-20799`,cast(SUM(case when `income_range_modeled` in ('104000-155999') then 1 else 0 end) as tinyint) as `income_range_modeled_104000-155999`,cast(SUM(case when `income_range_modeled` in ('156000+') then 1 else 0 end) as tinyint) as `income_range_modeled_156000+`,cast(SUM(case when `income_range_modeled` in ('20800-41599') then 1 else 0 end) as tinyint) as `income_range_modeled_20800-41599`,cast(SUM(case when `income_range_modeled` in ('41600-64999') then 1 else 0 end) as tinyint) as `income_range_modeled_41600-64999`,cast(SUM(case when `income_range_modeled` in ('65000-77999') then 1 else 0 end) as tinyint) as `income_range_modeled_65000-77999`,cast(SUM(case when `income_range_modeled` in ('78000-103999') then 1 else 0 end) as tinyint) as `income_range_modeled_78000-103999` &quot;</span>

<span class="fc" id="L146">    query1 = query1 + staticQuery</span>
<span class="fc" id="L147">    query1 += &quot;&quot;&quot; FROM acxiom_keys_view k INNER JOIN df1_view d1 ON k.stringId = d1.liveramp_mbid GROUP BY numericId DISTRIBUTE BY numericId &quot;&quot;&quot;</span>

<span class="fc" id="L149">    val acxiomAu = sql.sql(query1)</span>

<span class="fc" id="L151">    acxiomAu.repartition(16).write.mode(SaveMode.Overwrite).option(MapRedFilOutComAlgVer, &quot;2&quot;).parquet(outputPath)</span>

  }


  def reportAcxiom(acxiomPath: String,
                   acxiomMbidColumnName: String,
                   desiredColumnsPath: String,
                   acxiomKeyInfo: AcxiomKeyInfo,
                   numericIdColumnName: String,
                   outputPath: String,
                   batchSize: Int): Unit = {

<span class="fc" id="L164">    var acxiomInput = spark.read.parquet(acxiomPath)</span>
<span class="fc" id="L165">    val uniqueKeys = spark.read.parquet(acxiomKeyInfo.acxiomKeysPath)</span>
<span class="fc" id="L166">    val columnsDf = spark.read.option(&quot;delimiter&quot;, &quot;|&quot;).option(&quot;header&quot;, &quot;true&quot;).csv(desiredColumnsPath)</span>

<span class="fc" id="L168">    val acxiomDf = uniqueKeys.join(acxiomInput, uniqueKeys.col(acxiomKeyInfo.acxiomKeysMbidColumnName) === acxiomInput.col(acxiomMbidColumnName), &quot;inner&quot;)</span>
<span class="fc" id="L169">    acxiomDf.createOrReplaceTempView(&quot;acxiom_table&quot;)</span>

<span class="fc" id="L171">    val columnsMap = columnsDf.collect()</span>

<span class="fc" id="L173">    val rowPrefix = &quot;,cast((case when &quot;</span>
<span class="fc" id="L174">    val rowSufix = &quot; then 1 else 0 end) as tinyint) as &quot;</span>
<span class="fc" id="L175">    var rowsSQL = &quot;&quot;</span>

<span class="fc" id="L177">    for (col &lt;- columnsMap) {</span>
<span class="fc" id="L178">      val originColName = col.getAs[String](&quot;origin_column&quot;)</span>
<span class="fc" id="L179">      val oneValues = col.getAs[String](&quot;one_values&quot;)</span>
<span class="fc" id="L180">      val aliasColName = col.getAs[String](&quot;alias_column_name&quot;)</span>
<span class="fc" id="L181">      val caseSting = rowPrefix + originColName + &quot; in &quot; + oneValues + rowSufix + aliasColName</span>
<span class="fc" id="L182">      rowsSQL += caseSting</span>
    }

<span class="fc" id="L185">    val sqlPrefix = &quot;SELECT CAST(&quot; + numericIdColumnName + &quot; as bigint) as numericId &quot;</span>
<span class="fc" id="L186">    val sqlSufix = &quot; FROM acxiom_table&quot;</span>
<span class="fc" id="L187">    val fullSQL = sqlPrefix + rowsSQL + sqlSufix</span>

<span class="fc" id="L189">    spark.sql(fullSQL)</span>
<span class="fc" id="L190">      .write.mode(SaveMode.Overwrite)</span>
<span class="fc" id="L191">      .option(MapRedFilOutComAlgVer, &quot;2&quot;)</span>
<span class="fc" id="L192">      .parquet(outputPath)</span>
  }


  def generateProfileReport(acxiomInfo: AcxiomInfo,
                            acxiomKeyInfo: AcxiomKeyInfo,
                            desiredColumnsPath: String,
                            dropColumns: Seq[String],
                            numericIdColumnName: String,
                            outputPath: String,
<span class="pc" id="L202">                            batchSize: Int = 1): Unit = {</span>

<span class="pc bpc" id="L204" title="3 of 6 branches missed.">    if (acxiomInfo.acxiomMarket == &quot;US&quot;) {</span>
<span class="fc" id="L205">      reportAcxiomUS(</span>
<span class="fc" id="L206">        acxiomInfo.acxiomPath,</span>
<span class="fc" id="L207">        acxiomKeyInfo.acxiomKeysPath,</span>
<span class="fc" id="L208">        outputPath)</span>
    }
<span class="pc bpc" id="L210" title="3 of 6 branches missed.">    if (acxiomInfo.acxiomMarket == &quot;AU&quot;) {</span>
<span class="fc" id="L211">      reportAcxiomAU(</span>
<span class="fc" id="L212">        acxiomInfo.acxiomPath,</span>
<span class="fc" id="L213">        acxiomInfo.acxiomLiverampMapPath,</span>
<span class="fc" id="L214">        acxiomKeyInfo.acxiomKeysPath,</span>
<span class="fc" id="L215">        acxiomInfo.acxiomFilterExpr,</span>
<span class="fc" id="L216">        dropColumns,</span>
<span class="fc" id="L217">        outputPath)</span>
    }

<span class="pc bpc" id="L220" title="7 of 12 branches missed.">    if (acxiomInfo.acxiomMarket == &quot;UK&quot; || acxiomInfo.acxiomMarket == &quot;MX&quot;)</span>
<span class="fc" id="L221">      reportAcxiom(</span>
<span class="fc" id="L222">        acxiomInfo.acxiomPath,</span>
<span class="fc" id="L223">        acxiomInfo.acxiomMbidColumnName,</span>
<span class="fc" id="L224">        desiredColumnsPath,</span>
<span class="fc" id="L225">        acxiomKeyInfo,</span>
<span class="fc" id="L226">        numericIdColumnName,</span>
<span class="fc" id="L227">        outputPath,</span>
<span class="fc" id="L228">        batchSize)</span>
  }

  override def run(args: JSONObject): Unit = {

<span class="fc" id="L233">    val acxiomMarket = args.getString(&quot;acxiom_market&quot;)</span>
<span class="fc" id="L234">    val acxiomPath = args.getString(&quot;acxiom_path&quot;)</span>
<span class="fc" id="L235">    val acxiomMbidColumnName = args.getOrElse[String](&quot;acxiom_mbid_column_name&quot;, &quot;&quot;)</span>
<span class="fc" id="L236">    val desiredColumnsPath = args.getOrElse(&quot;desired_columns_path&quot;, &quot;&quot;)</span>
<span class="fc" id="L237">    val acxiomLiverampMapPath = args.getOrElse[String](&quot;acxiom_liveramp_map_path&quot;, &quot;&quot;)</span>
<span class="fc" id="L238">    val acxiomKeysPath = args.getString(&quot;acxiom_keys_path&quot;)</span>
<span class="fc" id="L239">    val acxiomKeysMbidColumnName = args.getOrElse[String](&quot;acxiom_keys_mbid_column_name&quot;, &quot;&quot;)</span>
<span class="fc" id="L240">    val numericIdColumnName = args.getOrElse[String](&quot;numeric_id_column_name&quot;, &quot;&quot;)</span>
<span class="fc" id="L241">    val outputPath = args.getString(&quot;output_path&quot;)</span>
<span class="fc" id="L242">    val acxiomFilterExpr = args.getOrElse[String](&quot;acxiom_filter_expr&quot;, &quot;&quot;)</span>
<span class="fc" id="L243">    val dropColumns = args.getOrElseSeq(&quot;drop_columns&quot;, Seq.empty[String])</span>
<span class="fc" id="L244">    val batchSize = args.getOrElse[Int](&quot;batch_size&quot;, 1)</span>

<span class="fc" id="L246">    val acxiomInfo = AcxiomInfo(acxiomMarket,acxiomPath,acxiomMbidColumnName,acxiomLiverampMapPath,acxiomFilterExpr)</span>
<span class="fc" id="L247">    val acxiomKeyInfo = AcxiomKeyInfo(acxiomKeysPath,acxiomKeysMbidColumnName)</span>

<span class="fc" id="L249">    generateProfileReport(</span>
<span class="fc" id="L250">      acxiomInfo,</span>
<span class="fc" id="L251">      acxiomKeyInfo,</span>
<span class="fc" id="L252">      desiredColumnsPath,</span>
<span class="fc" id="L253">      dropColumns,</span>
<span class="fc" id="L254">      numericIdColumnName,</span>
<span class="fc" id="L255">      outputPath,</span>
<span class="fc" id="L256">      batchSize)</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span></div></body></html>