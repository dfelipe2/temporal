<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DataSetValidation.scala</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">CIA</a> &gt; <a href="index.source.html" class="el_package">com.mbww.cia.qa.dataSet</a> &gt; <span class="el_source">DataSetValidation.scala</span></div><h1>DataSetValidation.scala</h1><pre class="source lang-java linenums">package com.mbww.cia.qa.dataSet

import java.io.{BufferedReader, FileNotFoundException, InputStreamReader}
import java.text.SimpleDateFormat

import com.amazonaws.services.s3.AmazonS3
import com.amazonaws.services.s3.model.GetObjectRequest
import com.mbww.cia.common._
import com.mbww.cia.qa.utils.{DataSetFile, FileData, Setup, UtilsFunction}
import org.json.JSONObject
import org.slf4j.LoggerFactory

import scala.collection.mutable.ListBuffer

<span class="fc" id="L15">class DataSetValidation extends Module  {</span>
<span class="fc" id="L16">  val logger = LoggerFactory.getLogger(&quot;CIA Pipeline&quot;)</span>
<span class="fc" id="L17">  def headerValidation(awsS3Client: AmazonS3,  setup:Setup,datasetFilePath: String, delimiter: String = &quot;\t&quot;): Boolean = {</span>
<span class="nc" id="L18">    try {</span>
<span class="pc bpc" id="L19" title="115 of 119 branches missed.">      case class actualDataSetHeader(dataProvider: String, dataSource: String, displayName: String, datasetType: String, bitmapRootPath: String, customAttributeRootPath: String, taxonomyRootPath: String, timeLine: String, version: String, minorversion: String, mbidBitmapRootFolder: String, hhidBitmapRootFolder: String, displayFile: String, bitmapFile: String)</span>
<span class="fc" id="L20">      val expectedValue = DataSetFile.DataSetHeader()</span>
<span class="fc" id="L21">      var line = &quot;&quot;</span>
<span class="fc" id="L22">      val s3Object = awsS3Client.getObject(new GetObjectRequest(setup.bucketName, datasetFilePath))</span>
<span class="fc" id="L23">      val reader = new BufferedReader(new InputStreamReader(s3Object.getObjectContent))</span>
<span class="pc bpc" id="L24" title="1 of 2 branches missed.">      if (!((line = reader.readLine).equals(null))) {</span>
<span class="fc" id="L25">        var data = line.split(delimiter)</span>
<span class="pc bpc" id="L26" title="1 of 2 branches missed.">        if (!(expectedValue.productIterator.length == data.length)) {</span>
<span class="nc" id="L27">          logger.info(&quot;########### header length is not correct ,length is  ########### &quot; + data.length)</span>
<span class="nc" id="L28">          return false</span>
        }
<span class="fc" id="L30">        logger.info(&quot;########### header length is  correct ,length is  ########### &quot; + data.length)</span>
<span class="fc" id="L31">        var actualValue = actualDataSetHeader(data(0), data(1), data(2), data(3), data(4), data(5),</span>
<span class="fc" id="L32">          data(6), data(7), data(8), data(9), data(10), data(11),</span>
<span class="fc" id="L33">          data(12), data(13))</span>
<span class="pc bpc" id="L34" title="1 of 2 branches missed.">        if (!(actualValue.dataProvider.equals(expectedValue.dataProvider))) {</span>
<span class="nc" id="L35">          logger.info(&quot;########### header name  dataProvider is not present ########### &quot;)</span>
<span class="nc" id="L36">          return false</span>
        }
<span class="fc" id="L38">        logger.info(&quot;########### header name   dataProvider  is  present ########### &quot;)</span>
<span class="pc bpc" id="L39" title="1 of 2 branches missed.">        if (!(actualValue.dataSource.equals(expectedValue.dataSource))) {</span>
<span class="nc" id="L40">          logger.info(&quot;########### header name  dataSource is not present ########### &quot;)</span>
<span class="nc" id="L41">          return false</span>
        }
<span class="fc" id="L43">        logger.info(&quot;########### header name   dataSource is  present ########### &quot;)</span>

<span class="pc bpc" id="L45" title="1 of 2 branches missed.">        if (!(actualValue.displayName.equals(expectedValue.displayName))) {</span>
<span class="nc" id="L46">          logger.info(&quot;########### header name  displayName is not present ########### &quot;)</span>
<span class="nc" id="L47">          return false</span>
        }
<span class="fc" id="L49">        logger.info(&quot;########### header name   displayName is  present ########### &quot;)</span>
<span class="pc bpc" id="L50" title="1 of 2 branches missed.">        if (!(actualValue.datasetType.equals(expectedValue.dataSetType))) {</span>
<span class="nc" id="L51">          logger.info(&quot;########### header name  dataset Type is not present ########### &quot;)</span>
<span class="nc" id="L52">          return false</span>
        }
<span class="fc" id="L54">        logger.info(&quot;########### header name   dataset Type is  present ########### &quot;)</span>
<span class="pc bpc" id="L55" title="1 of 2 branches missed.">        if (!(actualValue.bitmapRootPath.equals(expectedValue.bitmapRootPath))) {</span>
<span class="nc" id="L56">          logger.info(&quot;########### header name  bitmapRootPath is not present ########### &quot;)</span>
<span class="nc" id="L57">          return false</span>
        }
<span class="fc" id="L59">        logger.info(&quot;########### header name   bitmapRootPath is  present ########### &quot;)</span>
<span class="pc bpc" id="L60" title="1 of 2 branches missed.">        if (!(actualValue.customAttributeRootPath.equals(expectedValue.customAttributeRootPath))) {</span>
<span class="nc" id="L61">          logger.info(&quot;########### header name  customAttributeRootPath is not present ########### &quot;)</span>
<span class="nc" id="L62">          return false</span>
        }
<span class="fc" id="L64">        logger.info(&quot;########### header name   customAttributeRootPath is  present ########### &quot;)</span>
<span class="pc bpc" id="L65" title="1 of 2 branches missed.">        if (!(actualValue.taxonomyRootPath.equals(expectedValue.taxonomyRootPath))) {</span>
<span class="nc" id="L66">          logger.info(&quot;########### header name  taxonomyRootPath   is not present ########### &quot;)</span>
<span class="nc" id="L67">          return false</span>
        }
<span class="fc" id="L69">        logger.info(&quot;########### header name  taxonomyRootPath  is  present ########### &quot;)</span>
<span class="pc bpc" id="L70" title="1 of 2 branches missed.">        if (!(actualValue.timeLine.equals(expectedValue.timeLine))) {</span>
<span class="nc" id="L71">          logger.info(&quot;########### header name timeLine is not present ########### &quot;)</span>
<span class="nc" id="L72">          return false</span>
        }
<span class="fc" id="L74">        logger.info(&quot;########### header name timeLine is  present ########### &quot;)</span>
<span class="pc bpc" id="L75" title="1 of 2 branches missed.">        if (!(actualValue.version.equals(expectedValue.version))) {</span>
<span class="nc" id="L76">          logger.info(&quot;########### header name version is not present ########### &quot;)</span>
<span class="nc" id="L77">          return false</span>
        }
<span class="fc" id="L79">        logger.info(&quot;########### header name version is  present ########### &quot;)</span>
<span class="pc bpc" id="L80" title="1 of 2 branches missed.">        if (!(actualValue.minorversion.equals(expectedValue.minorversion))) {</span>
<span class="nc" id="L81">          logger.info(&quot;########### header name minorversion is not present ########### &quot;)</span>
<span class="nc" id="L82">          return false</span>
        }
<span class="fc" id="L84">        logger.info(&quot;########### header name minorversion is  present ########### &quot;)</span>
<span class="pc bpc" id="L85" title="1 of 2 branches missed.">        if (!(actualValue.mbidBitmapRootFolder.equals(expectedValue.mbidBitmapRootFolder))) {</span>
<span class="nc" id="L86">          logger.info(&quot;########### header name mbidBitmapRootFolder is not present ########### &quot;)</span>
<span class="nc" id="L87">          return false</span>
        }
<span class="fc" id="L89">        logger.info(&quot;########### header name mbidBitmapRootFolder is  present ########### &quot;)</span>
<span class="pc bpc" id="L90" title="1 of 2 branches missed.">        if (!(actualValue.hhidBitmapRootFolder.equals(expectedValue.hhidBitmapRootFolder))) {</span>
<span class="nc" id="L91">          logger.info(&quot;########### header name hhidBitmapRootFolder is not present ########### &quot;)</span>
<span class="nc" id="L92">          return false</span>
        }
<span class="fc" id="L94">        logger.info(&quot;########### header name hhidBitmapRootFolder is  present ########### &quot;)</span>
<span class="pc bpc" id="L95" title="1 of 2 branches missed.">        if (!(actualValue.displayFile.equals(expectedValue.displayFile))) {</span>
<span class="nc" id="L96">          logger.info(&quot;########### header name displayFile is not present ########### &quot;)</span>
<span class="nc" id="L97">          return false</span>
        }
<span class="fc" id="L99">        logger.info(&quot;########### header name displayFile is  present ########### &quot;)</span>
<span class="pc bpc" id="L100" title="1 of 2 branches missed.">        if (!(actualValue.bitmapFile.equals(expectedValue.bitmapFile))) {</span>
<span class="nc" id="L101">          logger.info(&quot;########### header name bitmapFile is not present ########### &quot;)</span>
<span class="nc" id="L102">          return false</span>
        }
<span class="fc" id="L104">        logger.info(&quot;########### header name bitmapFile is  present ########### &quot;)</span>
      }
    }
    catch {
      // Handle exceptions.
      case exp: FileNotFoundException =&gt;
<span class="nc" id="L110">        logger.info(&quot;################### file is not present   &quot; + exp)</span>
<span class="nc" id="L111">        return false</span>
      case exp: ArrayIndexOutOfBoundsException =&gt;
<span class="nc" id="L113">        logger.info(&quot;################### ArrayIndexOutOfBoundsException  &quot; + exp)</span>
<span class="nc" id="L114">        return false</span>
      case exp: NullPointerException =&gt;
<span class="nc" id="L116">        logger.info(&quot;null pointer  &quot; + exp)</span>
<span class="nc" id="L117">        return false</span>
    }
<span class="fc" id="L119">    logger.info(&quot;------------------ Data Set File  Header Validation Pass , All Header are present  --------------------------&quot;)</span>
<span class="fc" id="L120">    true</span>
  }

<span class="fc" id="L123">  def specialCharacterValidation(awsS3Client: AmazonS3,  setup:Setup,dataSetFilePath: String, delimiter: String = &quot;\t&quot;): Boolean = {</span>
<span class="fc" id="L124">    UtilsFunction.specialCharacterValidation(awsS3Client,setup, dataSetFilePath)</span>
  }

  def timeFormateValidation(date: String): Boolean =
<span class="pc" id="L128">    try {</span>
<span class="fc" id="L129">      val df = new SimpleDateFormat(&quot;MM/dd/yyyy&quot;)</span>
<span class="fc" id="L130">      df.setLenient(false)</span>
<span class="fc" id="L131">      df.parse(date)</span>
<span class="fc" id="L132">      true</span>
    } catch {
      case e: java.text.ParseException =&gt;
<span class="nc" id="L135">        false</span>
    }

<span class="fc" id="L138">  def timeLineValueValidation(awsS3Client: AmazonS3,  setup:Setup,displayFilePath: String, delimiter: String = &quot;\t&quot;): Boolean = {</span>
<span class="pc bnc" id="L139" title="All 2 branches missed.">    try {</span>
<span class="fc" id="L140">      var line = &quot;&quot;</span>
<span class="fc" id="L141">      var s3Object = awsS3Client.getObject(new GetObjectRequest(setup.bucketName, displayFilePath))</span>
<span class="fc" id="L142">      var reader = new BufferedReader(new InputStreamReader(s3Object.getObjectContent))</span>
<span class="fc" id="L143">      var filelength = reader.lines().count()</span>
<span class="fc" id="L144">      s3Object = awsS3Client.getObject(new GetObjectRequest(setup.bucketName, displayFilePath))</span>
<span class="fc" id="L145">      reader = new BufferedReader(new InputStreamReader(s3Object.getObjectContent))</span>
<span class="fc" id="L146">      reader.readLine.drop(0)</span>
<span class="pc bpc" id="L147" title="1 of 2 branches missed.">      for (i &lt;- 0 to filelength.toInt - 2) {</span>
<span class="fc" id="L148">        line = reader.readLine</span>
<span class="fc" id="L149">        val data = line.split(delimiter)(7).split(&quot;-&quot;)</span>
<span class="fc" id="L150">        val startTimeLine = data(0).trim</span>
<span class="fc" id="L151">        val endTimeLine = data(1).trim</span>
<span class="pc bpc" id="L152" title="1 of 2 branches missed.">        if (!(timeFormateValidation(startTimeLine))) {</span>
<span class="nc" id="L153">          logger.info(&quot;############################### startTimeLine is not correct ##### :- &quot;)</span>
<span class="nc" id="L154">          return false</span>
        }
<span class="pc bpc" id="L156" title="1 of 2 branches missed.">        if (!(timeFormateValidation(endTimeLine))) {</span>
<span class="nc" id="L157">          logger.info(&quot;############################### endTimeLine is not correct ##### :- &quot;)</span>
<span class="nc" id="L158">          return false</span>
        }

      }
<span class="fc" id="L162">      logger.info(&quot;########### Time line format is correct  ########### &quot;)</span>
<span class="fc" id="L163">      true</span>
    }
    catch {
      case exp: FileNotFoundException =&gt;
<span class="nc" id="L167">        logger.info(&quot;################### file is not present   &quot; + exp)</span>
<span class="nc" id="L168">        return false</span>
      case exp: ArrayIndexOutOfBoundsException =&gt;
<span class="nc" id="L170">        logger.info(&quot;################### Array Index OutOf Bounds Exception  &quot; + exp)</span>
<span class="nc" id="L171">        return false</span>
      case exp: NullPointerException =&gt;
<span class="nc" id="L173">        logger.info(&quot;null pointer  &quot; + exp)</span>
<span class="nc" id="L174">        return false</span>
      case exp: NumberFormatException =&gt;
<span class="nc" id="L176">        logger.info(&quot;Number format exception&quot; + exp)</span>
<span class="nc" id="L177">        return false</span>

    }
  }

<span class="nc bnc" id="L182" title="All 2 branches missed.">  def aclValueValidation(awsS3Client: AmazonS3, setup:Setup, datasetFile: String,   delimiter: String = &quot;\t&quot;): Boolean = {</span>
<span class="nc" id="L183">    var line = &quot;&quot;</span>
<span class="nc" id="L184">    var bucketName = setup.bucketName</span>
<span class="nc" id="L185">    var s3Object = awsS3Client.getObject(new GetObjectRequest(setup.bucketName, datasetFile))</span>
<span class="nc" id="L186">    var aclValue = &quot;&quot;</span>
<span class="nc" id="L187">    var accessLevel = &quot;&quot;</span>
<span class="nc" id="L188">    var reader = new BufferedReader(new InputStreamReader(s3Object.getObjectContent))</span>
<span class="nc" id="L189">    var filelength = reader.lines().count()</span>
<span class="nc" id="L190">    s3Object = awsS3Client.getObject(new GetObjectRequest(setup.bucketName, datasetFile))</span>
<span class="nc" id="L191">    reader = new BufferedReader(new InputStreamReader(s3Object.getObjectContent))</span>
<span class="nc" id="L192">    reader.readLine.drop(0)</span>
<span class="nc bnc" id="L193" title="All 2 branches missed.">    for (i &lt;- 0 to filelength.toInt - 2) {</span>
<span class="nc" id="L194">      try {</span>
<span class="nc" id="L195">        line = reader.readLine</span>
<span class="nc" id="L196">        accessLevel = line.split(delimiter)(4)</span>
<span class="nc bnc" id="L197" title="All 2 branches missed.">        if (accessLevel.equals(&quot;Public&quot;)) {</span>
<span class="nc" id="L198">          try {</span>
<span class="nc" id="L199">            aclValue = line.split(delimiter)(17)</span>
<span class="nc" id="L200">            logger.info(&quot;############################### accessLevel is public and ACL is not blank ##### :- &quot;)</span>
<span class="nc" id="L201">            return false</span>
          }
          catch {
            case exp: ArrayIndexOutOfBoundsException =&gt;
<span class="nc" id="L205">              logger.info(&quot;############################### accessLevel is public and ACL is blank ##### :- &quot;)</span>
          }
        }
        else {
<span class="nc" id="L209">          try {</span>
<span class="nc" id="L210">            aclValue = line.split(delimiter)(17)</span>
<span class="nc" id="L211">            logger.info(&quot;############################### accessLevel is ACL and ACL is not blank ##### :- &quot;)</span>
          }
          catch {
            case exp: ArrayIndexOutOfBoundsException =&gt;
<span class="nc" id="L215">              logger.info(&quot;############################### accessLevel is ACL and ACL is blank ##### :- &quot;)</span>
<span class="nc" id="L216">              return false</span>
          }
        }

      } catch {
        // Handle exceptions.
<span class="nc" id="L222">        case exp: ArrayIndexOutOfBoundsException =&gt;</span>
<span class="nc" id="L223">          logger.info(&quot;################### Array Index OutOf Bounds Exception  &quot; + exp)</span>
<span class="nc" id="L224">          return false</span>
        case exp: NullPointerException =&gt;
      }
    }

<span class="nc" id="L229">    return true</span>
  }

<span class="pc bnc" id="L232" title="All 2 branches missed.">  def columnContainsBlankValueValidations(awsS3Client: AmazonS3, setup:Setup,filePath: String, columnPosition: Int, columnName:String,delimiter: String = &quot;\t&quot;): Boolean = {</span>
<span class="fc" id="L233">    var datasetType = &quot;&quot;</span>
<span class="fc" id="L234">    var path = &quot;&quot;</span>
<span class="nc" id="L235">    try {</span>
<span class="fc" id="L236">       var lineIterator =UtilsFunction.getLinesFromFile(&quot;s3://&quot; + setup.bucketName + &quot;/&quot; + filePath, awsS3Client)</span>
<span class="fc" id="L237">        lineIterator.drop(1)</span>
<span class="fc" id="L238">        for (i &lt;- lineIterator) {</span>
<span class="fc" id="L239">          datasetType = i.split(delimiter)(3)</span>
<span class="fc" id="L240">          try {</span>
<span class="fc" id="L241">            path = i.split(delimiter)(columnPosition)</span>
<span class="pc bpc" id="L242" title="4 of 8 branches missed.">            if ((path.isEmpty)||(path.trim==&quot;&quot;)) {</span>
<span class="pc bpc" id="L243" title="1 of 2 branches missed.">              if (!datasetType.equals(&quot;Custom Attr&quot;)) {</span>
<span class="nc" id="L244">                return false</span>
              }
            }
            else {
<span class="pc bpc" id="L248" title="1 of 2 branches missed.">              if (!datasetType.equals(&quot;Taxonomy&quot;)) {</span>
<span class="nc" id="L249">                return false</span>
              }
            }
          }
        catch
        {
          case exp: ArrayIndexOutOfBoundsException =&gt;
<span class="pc bpc" id="L256" title="1 of 2 branches missed.">             if (!datasetType.equals(&quot;Custom Attr&quot;)) {</span>
<span class="nc" id="L257">              return false</span>
            }
        }
        }
<span class="fc" id="L261">        logger.info(&quot;########### not contains blank data   in file ########### &quot; + columnName)</span>
<span class="fc" id="L262">      return true</span>
      }
    catch {
      case exp: FileNotFoundException =&gt;
<span class="nc" id="L266">        logger.info(&quot;################### file is not present   &quot; + exp)</span>
<span class="nc" id="L267">        return false</span>
      case exp: ArrayIndexOutOfBoundsException =&gt;
<span class="nc bnc" id="L269" title="All 2 branches missed.">        if (datasetType.equals(&quot;Custom Attr&quot;))</span>
        {
<span class="nc" id="L271">          logger.info(&quot;###################  path is empty for Dataset Type Custom Attr &quot;)</span>
<span class="nc" id="L272">          return true</span>
        }
        else
<span class="nc" id="L275">          return false</span>
      case exp: NullPointerException =&gt;
<span class="nc" id="L277">        logger.info(&quot;null pointer  &quot; + exp)</span>
<span class="nc" id="L278">        return false</span>
    }
  }

<span class="pc bpc" id="L282" title="1 of 2 branches missed.">  def columnContainsBlankValueValidationsForHhidPath(awsS3Client: AmazonS3, setup:Setup,filePath: String, columnPosition: Int, columnName:String,delimiter: String = &quot;\t&quot;): Boolean = {</span>
<span class="fc" id="L283">    var datasetType = &quot;&quot;</span>
<span class="fc" id="L284">    var path = &quot;&quot;</span>
<span class="nc" id="L285">    try {</span>
<span class="pc bpc" id="L286" title="3 of 8 branches missed.">      if (!(setup.market.toUpperCase.equals(&quot;UK&quot;) || setup.market.toUpperCase.equals(&quot;AU&quot;) || setup.market.toUpperCase.equals(&quot;MX&quot;)|| setup.market.toUpperCase.equals(&quot;JP&quot;)))</span>
      {
<span class="fc" id="L288">        var lineIterator =UtilsFunction.getLinesFromFile(&quot;s3://&quot; + setup.bucketName + &quot;/&quot; + filePath, awsS3Client)</span>
<span class="fc" id="L289">        lineIterator.drop(1)</span>
<span class="pc bpc" id="L290" title="1 of 2 branches missed.">        for (i &lt;- lineIterator) {</span>
<span class="fc" id="L291">          datasetType = i.split(delimiter)(3)</span>
<span class="fc" id="L292">          val dataProviderName=i.split(delimiter)(0)</span>
<span class="fc" id="L293">          logger.info(&quot;################### Data Provider Name is :&quot; + dataProviderName)</span>
<span class="fc" id="L294">          try {</span>
<span class="fc" id="L295">            path = i.split(delimiter)(columnPosition)</span>
<span class="pc bpc" id="L296" title="1 of 2 branches missed.">            if (path.isEmpty) {</span>
<span class="nc bnc" id="L297" title="All 2 branches missed.">              if (!datasetType.equals(&quot;Custom Attr&quot;)) {</span>
<span class="nc" id="L298">                return false</span>
              }
            }
            else {
<span class="pc bpc" id="L302" title="1 of 2 branches missed.">              if (!datasetType.equals(&quot;Taxonomy&quot;)) {</span>
<span class="nc" id="L303">                return false</span>
              }
            }
          }
          catch
            {
              case exp: ArrayIndexOutOfBoundsException =&gt;
<span class="fc" id="L310">                logger.info(&quot;path is empty for : &quot; + dataProviderName)</span>
<span class="pc bpc" id="L311" title="1 of 2 branches missed.">                if (!datasetType.equals(&quot;Custom Attr&quot;)) {</span>
<span class="nc" id="L312">                  return false</span>
                }
                else
<span class="fc" id="L315">                  return true</span>

            }
        }

      }
      else
      {
<span class="fc" id="L323">        logger.info(&quot;########### HHID file path will not be tested for UK,AU,JP and MX market ########### &quot;)</span>
<span class="fc" id="L324">        return true</span>
      }
<span class="nc" id="L326">      true</span>
    }
    catch {
      case exp: FileNotFoundException =&gt;
<span class="nc" id="L330">        logger.info(&quot;################### file is not present   &quot; + exp)</span>
<span class="nc" id="L331">        return false</span>
      case exp: ArrayIndexOutOfBoundsException =&gt;
<span class="nc bnc" id="L333" title="All 2 branches missed.">        if (datasetType.equals(&quot;Custom Attr&quot;))</span>
        {
<span class="nc" id="L335">          logger.info(&quot;###################  path is empty for Dataset Type Custom Attr &quot;)</span>
<span class="nc" id="L336">          return true</span>
        }
        else
<span class="nc" id="L339">          return false</span>
      case exp: NullPointerException =&gt;
<span class="nc" id="L341">        logger.info(&quot;null pointer  &quot; + exp)</span>
<span class="nc" id="L342">        return false</span>
    }

  }

<span class="fc" id="L347">  def columnContainBlankValueValidation(awsS3Client: AmazonS3, setup:Setup,filePath: String, columnPosition: Int,columnName:String, delimiter: String = &quot;\t&quot;): Boolean = {</span>
<span class="fc" id="L348">    val data = UtilsFunction.getColumnFromFile(awsS3Client, &quot;s3://&quot; + setup.bucketName + &quot;/&quot; + filePath, columnPosition)</span>
<span class="pc bpc" id="L349" title="1 of 2 branches missed.">    if (!(data.contains(&quot;&quot;))) {</span>
<span class="fc" id="L350">      logger.info(&quot;############################### Column Does not contains blank value ###### &quot; + columnName)</span>
<span class="fc" id="L351">      return true</span>
    }
<span class="nc" id="L353">    logger.info(&quot;############################### Column  contains blank value ###### &quot; + columnName)</span>
<span class="nc" id="L354">    false</span>
  }


<span class="nc" id="L358">  def getColumnFromFileDataSetFile(awsS3Client: AmazonS3,filePath: String, columnPosition: Int, delimiter: String = &quot;\t&quot;): List[String] = {</span>
<span class="nc" id="L359">    var data = new ListBuffer[String]()</span>
<span class="nc" id="L360">    val lineIterator = UtilsFunction.getLinesFromFile(filePath, awsS3Client)</span>
<span class="nc" id="L361">    lineIterator.drop(1)</span>
<span class="nc bnc" id="L362" title="All 2 branches missed.">    for (i &lt;- lineIterator) {</span>
<span class="nc bnc" id="L363" title="All 2 branches missed.">      if (!i.contains(&quot;custom-attribute-store&quot;)) {</span>
<span class="nc" id="L364">        try {</span>
<span class="nc" id="L365">          data += i.split(delimiter)(columnPosition)</span>
        }
        catch {
          case exp: ArrayIndexOutOfBoundsException =&gt;
<span class="nc" id="L369">            var x: Int = data.size</span>
<span class="nc" id="L370">            x += 1</span>
<span class="nc" id="L371">            logger.info(&quot;################### column data is empty At Index= &quot; + x)</span>
<span class="nc" id="L372">            data += &quot;&quot;</span>
        }
      }
      else {
<span class="nc" id="L376">        data += &quot;&quot;</span>

      }
    }
<span class="nc" id="L380">    data.toList</span>
  }

<span class="pc bnc" id="L383" title="All 2 branches missed.">  def dataSetTypeValueValidation(awsS3Client: AmazonS3, setup:Setup,datasetFile: String,  delimiter: String = &quot;\t&quot;): Boolean = {</span>
<span class="fc" id="L384">    var line = &quot;&quot;</span>
<span class="fc" id="L385">    var bucketName: String = setup.bucketName</span>
<span class="fc" id="L386">    var dataSetTypeValue = new ListBuffer[String]()</span>
<span class="fc" id="L387">    var distinctdataSetTypeValue = new ListBuffer[String]()</span>
<span class="fc" id="L388">    var expecteddistinctdataSetTypeValue = new ListBuffer[String]()</span>
<span class="fc" id="L389">    expecteddistinctdataSetTypeValue +=(&quot;Taxonomy&quot;, &quot;Custom Attr&quot;)</span>
<span class="fc" id="L390">    var s3Object = awsS3Client.getObject(new GetObjectRequest(setup.bucketName, datasetFile))</span>
<span class="fc" id="L391">    var reader = new BufferedReader(new InputStreamReader(s3Object.getObjectContent))</span>
<span class="fc" id="L392">    var filelength = reader.lines().count()</span>
<span class="fc" id="L393">    s3Object = awsS3Client.getObject(new GetObjectRequest(setup.bucketName, datasetFile))</span>
<span class="fc" id="L394">    reader = new BufferedReader(new InputStreamReader(s3Object.getObjectContent))</span>
<span class="fc" id="L395">    reader.readLine.drop(0)</span>
<span class="pc bpc" id="L396" title="1 of 2 branches missed.">    for (i &lt;- 0 to filelength.toInt - 2) {</span>
<span class="pc" id="L397">      try {</span>
<span class="fc" id="L398">        line = reader.readLine</span>
<span class="fc" id="L399">        dataSetTypeValue += line.split(delimiter)(3)</span>

      } catch {
        // Handle exceptions.
<span class="nc" id="L403">        case exp: ArrayIndexOutOfBoundsException =&gt;</span>
<span class="nc" id="L404">          logger.info(&quot;################### Array Index OutOf Bounds Exception  &quot; + exp)</span>
<span class="nc" id="L405">          return false</span>
        case exp: NullPointerException =&gt;
      }
    }
<span class="fc" id="L409">    distinctdataSetTypeValue = dataSetTypeValue.distinct</span>
<span class="fc" id="L410">    var differencedataSetType = distinctdataSetTypeValue -- (expecteddistinctdataSetTypeValue)</span>
<span class="pc bpc" id="L411" title="1 of 2 branches missed.">    if (!(differencedataSetType.length == 0)) {</span>
<span class="nc" id="L412">      logger.info(&quot;############################### distinct dataset Type value are not correct ##### :- &quot;)</span>

<span class="nc" id="L414">      return false</span>
    }
<span class="fc" id="L416">    logger.info(&quot;###############################  dataset Type value are correct ##### :- &quot;)</span>
<span class="fc" id="L417">    return true</span>
  }

<span class="fc" id="L420">  def dataSetTypeCustomAttributeValidation(awsS3Client: AmazonS3, setup:Setup,dataSetFilePath: String, matchingPartner: Any, delimiter: String = &quot;\t&quot;): Boolean = {</span>
<span class="pc bnc" id="L421" title="All 2 branches missed.">    try {</span>
<span class="fc" id="L422">      var datasetType = &quot;&quot;</span>
<span class="fc" id="L423">      var bitmapPath = &quot;&quot;</span>
<span class="fc" id="L424">      var customAttributePath = &quot;&quot;</span>
<span class="fc" id="L425">      var taxonomyPath = &quot;&quot;</span>
<span class="fc" id="L426">      var lineIterator = UtilsFunction.getLinesFromFile(&quot;s3://&quot; + setup.bucketName + &quot;/&quot; + dataSetFilePath, awsS3Client)</span>
<span class="fc" id="L427">      lineIterator.drop(1)</span>
<span class="fc" id="L428">      for (i &lt;- lineIterator) {</span>
<span class="fc" id="L429">        datasetType = i.split(delimiter)(3)</span>
<span class="fc" id="L430">        bitmapPath = i.split(delimiter)(4)</span>
<span class="fc" id="L431">        customAttributePath = i.split(delimiter)(5)</span>
<span class="fc" id="L432">        taxonomyPath = i.split(delimiter)(6)</span>
<span class="fc bfc" id="L433" title="All 2 branches covered.">        if (datasetType.equals(&quot;Custom Attr&quot;)) {</span>
<span class="pc bpc" id="L434" title="3 of 6 branches missed.">          if (!(customAttributePath.contains(&quot;custom-attribute-store/matching_partner&quot;) &amp;&amp; bitmapPath.isEmpty &amp;&amp; taxonomyPath.isEmpty)) {</span>
<span class="nc" id="L435">            return false</span>
          }

        }
<span class="fc bfc" id="L439" title="All 2 branches covered.">        if (datasetType.equals(&quot;Taxonomy&quot;)) {</span>
<span class="pc bpc" id="L440" title="3 of 6 branches missed.">          if (!(customAttributePath.isEmpty &amp;&amp; bitmapPath.contains(&quot;bitmap-store/matching_partner&quot;) &amp;&amp; taxonomyPath.contains(&quot;taxonomy-store/matching_partner&quot;))) {</span>
<span class="nc" id="L441">            return false</span>
          }
        }

      }
<span class="fc" id="L446">      logger.info(&quot;########### taxonomy path ,bitmap path is empty for datasetType custom Attr and custom attribute path is empty for dataset Type taxonomy  ########### &quot;)</span>
<span class="fc" id="L447">      true</span>
    }
    catch {
      case exp: FileNotFoundException =&gt;
<span class="nc" id="L451">        logger.info(&quot;################### file is not present   &quot; + exp)</span>
<span class="nc" id="L452">        return false</span>
      case exp: ArrayIndexOutOfBoundsException =&gt;
<span class="nc" id="L454">        logger.info(&quot;################### Array Index OutOf Bounds Exception  &quot; + exp)</span>
<span class="nc" id="L455">        return false</span>
      case exp: NullPointerException =&gt;
<span class="nc" id="L457">        logger.info(&quot;null pointer  &quot; + exp)</span>
<span class="nc" id="L458">        return false</span>

    }
  }

<span class="fc" id="L463">  def customAttributePathValueValidationForEmptyTaxonomyRootPath(awsS3Client: AmazonS3,setup:Setup,dataSetFilePath:String,matchingPartner:Any, delimiter: String = &quot;\t&quot;):Boolean =</span>
  {
<span class="nc" id="L465">    try {</span>
<span class="fc" id="L466">      val customAttributeAndTaxonomyPathValue=UtilsFunction.getTwoColumnFromFile(awsS3Client,&quot;s3://&quot; + setup.bucketName + &quot;/&quot; + dataSetFilePath,5,6)</span>
<span class="fc" id="L467">      val filtered=customAttributeAndTaxonomyPathValue.filter(x=&gt;x._2.isEmpty).map(_._1)</span>
<span class="fc bfc" id="L468" title="All 2 branches covered.">      val a=filtered.size&gt;0</span>
<span class="pc bpc" id="L469" title="1 of 4 branches missed.">      if (a &amp;&amp; !((filtered.toString().contains(&quot;/custom-attribute-store/matching_partner=&quot; + matchingPartner.toString.toLowerCase))))</span>
       {
<span class="nc" id="L471">        logger.info(&quot;################### taxonomy path  is  null and custom attribute path is not correct  &quot; + customAttributeAndTaxonomyPathValue.foreach(println))</span>
<span class="nc" id="L472">        return  false</span>
      }
      else{
<span class="fc" id="L475">        logger.info(&quot;################### taxonomy path  is null and custom attribute path is correct  &quot;)</span>
<span class="fc" id="L476">        return true</span>
      }

    }
    catch {
      // Handle exceptions.
      case exp:FileNotFoundException =&gt;    logger.info(&quot;################### file is not present   &quot; + exp)
<span class="nc" id="L483">        return false</span>
      case exp: ArrayIndexOutOfBoundsException =&gt;   logger.info(&quot;################### ArrayIndexOutOfBoundsException  &quot; + exp)
<span class="nc" id="L485">        return false</span>
      case exp: NullPointerException =&gt;     logger.info(&quot;null pointer  &quot; + exp)
<span class="nc" id="L487">        return false</span>
    }
  }



<span class="fc" id="L493">  def customAttributePathValidationForEmptyBitMapRootPathAndTaxonomyPath(awsS3Client: AmazonS3,setup:Setup,dataSetFilePath:String,matchingPartner:String,delimiter: String = &quot;\t&quot;):Boolean =</span>
  {
<span class="pc bnc" id="L495" title="All 2 branches missed.">    try{</span>
<span class="fc" id="L496">      var bitmapPath = &quot;&quot;</span>
<span class="fc" id="L497">      var customAttributePath = &quot;&quot;</span>
<span class="fc" id="L498">      var taxonomyPath = &quot;&quot;</span>
<span class="fc" id="L499">      var lineIterator = UtilsFunction.getLinesFromFile(&quot;s3://&quot; + setup.bucketName + &quot;/&quot; + dataSetFilePath, awsS3Client)</span>
<span class="fc" id="L500">      lineIterator.drop(1)</span>
<span class="fc" id="L501">      for (i &lt;- lineIterator) {</span>

<span class="fc" id="L503">        bitmapPath = i.split(delimiter)(4)</span>
<span class="fc" id="L504">        customAttributePath = i.split(delimiter)(5)</span>
<span class="fc" id="L505">        taxonomyPath = i.split(delimiter)(6)</span>
<span class="fc bfc" id="L506" title="All 2 branches covered.">        if (bitmapPath.isEmpty) {</span>
<span class="pc bpc" id="L507" title="2 of 4 branches missed.">          if (!(customAttributePath.contains(&quot;custom-attribute-store/matching_partner&quot;) &amp;&amp; taxonomyPath.isEmpty)) {</span>
<span class="nc" id="L508">            return false</span>
          }
        }
      }
<span class="fc" id="L512">      logger.info(&quot;########### Bitmap Root Path is empty , custom attribute root path  contain value and taxonomy root path is empty ########### &quot;)</span>
<span class="fc" id="L513">      true</span>
    }
    catch {
      case exp: FileNotFoundException =&gt;
<span class="nc" id="L517">        logger.info(&quot;################### file is not present   &quot; + exp)</span>
<span class="nc" id="L518">        return false</span>
      case exp: ArrayIndexOutOfBoundsException =&gt;
<span class="nc" id="L520">        logger.info(&quot;################### Array Index OutOf Bounds Exception  &quot; + exp)</span>
<span class="nc" id="L521">        return false</span>
      case exp: NullPointerException =&gt;
<span class="nc" id="L523">        logger.info(&quot;null pointer  &quot; + exp)</span>
<span class="nc" id="L524">        return false</span>

    }

  }
<span class="fc" id="L529">  def validation(marketName: String,</span>
                 bucket: String,
                 dataProviderName: String,
                 matchingPartnerName: String,
<span class="pc bnc" id="L533" title="All 2 branches missed.">                 thread_count: Int = 1,delimiter: String = &quot;\t&quot;): Boolean = {</span>
<span class="fc" id="L534">    val setup = new Setup(marketName,bucket,dataProviderName,matchingPartnerName)</span>
<span class="fc" id="L535">    val awsS3Client =setup.awsS3Client</span>
<span class="fc" id="L536">    val pColumns =  FileData.matchingPartnerGetData(awsS3Client,setup)</span>
<span class="nc" id="L537">    try{</span>
<span class="pc bpc" id="L538" title="2 of 4 branches missed.">    pColumns.foreach(matchingPartnerData=&gt; if(!(headerValidation(awsS3Client,setup,setup.dataSetFilePath(matchingPartnerData(1).asInstanceOf[Array[String]](2))))){</span>
<span class="nc" id="L539">      logger.info(</span>
<span class="nc" id="L540">        &quot;-----------------headerValidation is not correct---------------------&quot;)</span>
<span class="nc" id="L541">      return false</span>
    })
<span class="pc bpc" id="L543" title="2 of 4 branches missed.">    pColumns.foreach(matchingPartnerData=&gt;if(!(specialCharacterValidation(awsS3Client,setup,setup.dataSetFilePath(matchingPartnerData(1).asInstanceOf[Array[String]](2))))){</span>
<span class="nc" id="L544">      logger.info(&quot;-----------------specialCharacterValidation is not correct---------------------&quot;)</span>
<span class="nc" id="L545">      return false</span>
    })
<span class="pc bpc" id="L547" title="2 of 4 branches missed.">    pColumns.foreach(matchingPartnerData=&gt;if(!(timeLineValueValidation(awsS3Client,setup,setup.dataSetFilePath(matchingPartnerData(1).asInstanceOf[Array[String]](2))))){</span>
<span class="nc" id="L548">      logger.info(&quot;-----------------timeLineValueValidation is not correct---------------------&quot;)</span>
<span class="nc" id="L549">      return false</span>
    })
<span class="pc bpc" id="L551" title="2 of 4 branches missed.">    pColumns.foreach(matchingPartnerData=&gt;if(!(columnContainsBlankValueValidations(awsS3Client,setup,setup.dataSetFilePath(matchingPartnerData(1).asInstanceOf[Array[String]](2)),4,&quot;bitMapRootPath&quot;))){</span>
<span class="nc" id="L552">      logger.info(&quot;-----------------columnContainsBlankValueValidations is not correct---------------------&quot;)</span>
<span class="nc" id="L553">      return false</span>
    })
<span class="pc bpc" id="L555" title="2 of 4 branches missed.">    pColumns.foreach(matchingPartnerData=&gt;if(!(columnContainsBlankValueValidations(awsS3Client,setup,setup.dataSetFilePath(matchingPartnerData(1).asInstanceOf[Array[String]](2)),6,&quot;taxonomyRootPath&quot;))){</span>
<span class="nc" id="L556">      logger.info(&quot;-----------------columnContainsBlankValueValidations is not correct---------------------&quot;)</span>
<span class="nc" id="L557">      return false</span>
    })
<span class="pc bpc" id="L559" title="2 of 4 branches missed.">    pColumns.foreach(matchingPartnerData=&gt;if(!(columnContainBlankValueValidation(awsS3Client,setup,setup.dataSetFilePath(matchingPartnerData(1).asInstanceOf[Array[String]](2)),8,&quot;version&quot;))){</span>
<span class="nc" id="L560">      logger.info(&quot;-----------------columnContainBlankValueValidation is not correct---------------------&quot;)</span>
<span class="nc" id="L561">      return false</span>
    })
<span class="pc bpc" id="L563" title="2 of 4 branches missed.">    pColumns.foreach(matchingPartnerData=&gt;if(!(columnContainBlankValueValidation(awsS3Client,setup,setup.dataSetFilePath(matchingPartnerData(1).asInstanceOf[Array[String]](2)),9,&quot;minorVersion&quot;))){</span>
<span class="nc" id="L564">      logger.info(&quot;-----------------columnContainBlankValueValidation is not correct---------------------&quot;)</span>
<span class="nc" id="L565">      return false</span>
    })
<span class="pc bpc" id="L567" title="2 of 4 branches missed.">    pColumns.foreach(matchingPartnerData=&gt;if(!(columnContainsBlankValueValidations(awsS3Client,setup,setup.dataSetFilePath(matchingPartnerData(1).asInstanceOf[Array[String]](2)),10,&quot;mbidBitmapRootPath&quot;))){</span>
<span class="nc" id="L568">      logger.info(&quot;-----------------columnContainsBlankValueValidations is not correct---------------------&quot;)</span>
<span class="nc" id="L569">      return false</span>
    })
<span class="pc bpc" id="L571" title="2 of 4 branches missed.">    pColumns.foreach(matchingPartnerData=&gt;if(!(columnContainsBlankValueValidationsForHhidPath(awsS3Client,setup,setup.dataSetFilePath(matchingPartnerData(1).asInstanceOf[Array[String]](2)),11,&quot;hhidBitmapRootPath&quot;))){</span>
<span class="nc" id="L572">      logger.info(&quot;-----------------columnContainsBlankValueValidations is not correct---------------------&quot;)</span>
<span class="nc" id="L573">      return false</span>
    })

<span class="pc bpc" id="L576" title="2 of 4 branches missed.">   pColumns.foreach(matchingPartnerData=&gt;if(!(columnContainsBlankValueValidations(awsS3Client,setup,setup.dataSetFilePath(matchingPartnerData(1).asInstanceOf[Array[String]](2)),13,&quot; bitmapFile&quot;))){</span>
<span class="nc" id="L577">     logger.info(&quot;-----------------columnContainsBlankValueValidations is not correct---------------------&quot;)</span>
<span class="nc" id="L578">     return false</span>
   })

<span class="pc bpc" id="L581" title="2 of 4 branches missed.">   pColumns.foreach(matchingPartnerData=&gt;if(!(dataSetTypeValueValidation(awsS3Client,setup,setup.dataSetFilePath(matchingPartnerData(1).asInstanceOf[Array[String]](2))))){</span>
<span class="nc" id="L582">     logger.info(&quot;-----------------dataSetTypeValueValidation is not correct---------------------&quot;)</span>
<span class="nc" id="L583">     return false</span>
    })
<span class="pc bpc" id="L585" title="1 of 2 branches missed.">    pColumns.foreach{matchingPartnerData=&gt;</span>
<span class="pc bpc" id="L586" title="1 of 2 branches missed.">      if(!(dataSetTypeCustomAttributeValidation(awsS3Client,setup,setup.dataSetFilePath(matchingPartnerData(1).asInstanceOf[Array[String]](2)),matchingPartnerName ))){</span>
<span class="nc" id="L587">        logger.info(&quot;-----------------dataSetTypeCustomAttributeValueValidation is not correct---------------------&quot;)</span>
<span class="nc" id="L588">        return false</span>
    }}
<span class="pc bpc" id="L590" title="2 of 4 branches missed.">    pColumns.foreach(matchingPartnerData=&gt;if(!(customAttributePathValueValidationForEmptyTaxonomyRootPath(awsS3Client,setup,setup.dataSetFilePath(matchingPartnerData(1).asInstanceOf[Array[String]](2)),matchingPartnerName))){</span>
<span class="nc" id="L591">      logger.info(&quot;-----------------customAttributePathValueValidationForEmptyTaxonomyRootPath is not correct---------------------&quot;)</span>
<span class="nc" id="L592">      return false</span>
    })
<span class="pc bpc" id="L594" title="2 of 4 branches missed.">    pColumns.foreach(matchingPartnerData=&gt;if(!(customAttributePathValidationForEmptyBitMapRootPathAndTaxonomyPath(awsS3Client,setup,setup.dataSetFilePath(matchingPartnerData(1).asInstanceOf[Array[String]](2)),matchingPartnerName))){</span>
<span class="nc" id="L595">      logger.info(&quot;-----------------customAttributePathValidationForEmptyBitMapRootPathAndTaxonomyPath is not correct---------------------&quot;)</span>
<span class="nc" id="L596">      return false</span>
    })
<span class="pc bpc" id="L598" title="2 of 4 branches missed.">      pColumns.foreach(matchingPartnerData=&gt;if(!(columnContainsBlankValueValidations(awsS3Client,setup,setup.dataSetFilePath(matchingPartnerData(1).asInstanceOf[Array[String]](2)),12,&quot;displayFile&quot;))){</span>
<span class="nc" id="L599">        logger.info(&quot;-----------------columnContainsBlankValueValidations is not correct---------------------&quot;)</span>
<span class="nc" id="L600">        return false</span>
      })
<span class="fc" id="L602">    return true</span>
  }
    catch{
      case e:ArrayIndexOutOfBoundsException=&gt;return false
      case  ie:Exception=&gt; return false  }

  }
<span class="fc" id="L609">  override def run(args: JSONObject): Unit = {</span>

<span class="fc" id="L611">    val marketName = args.getString(&quot;marketName&quot;)</span>
<span class="fc" id="L612">    val bucket = args.getString(&quot;bucket&quot;)</span>
<span class="fc" id="L613">    val dataProviderName = args.getString(&quot;dataProviderName&quot;)</span>
<span class="fc" id="L614">    val matchingPartnerName = args.getString(&quot;matchingPartnerName&quot;)</span>
<span class="fc" id="L615">    val thread_count = args.getOrElse[Int](&quot;thread_count&quot;, 1)</span>
   
<span class="pc bpc" id="L617" title="1 of 2 branches missed.">    if(!validation(marketName,bucket,dataProviderName,matchingPartnerName,thread_count))</span>
    {
<span class="nc" id="L619">      throw new RuntimeException(&quot;-----------------Dataset File validation failed ---------------------&quot;)</span>
    }
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span></div></body></html>